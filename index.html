<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time Oil Price Dashboard - Professional Cyberpunk Interface">
    <title>Grok Oil Price Dashboard</title>
    <style>
        /* Inline CSS: Cyberpunk Glassmorphism Design System */
        :root {
            --deep-space-1: #0a0a0f;
            --deep-space-2: #0d1117;
            --deep-space-3: #111827;
            --electric-cyan: #00f5ff;
            --electric-blue: #3b82f6;
            --neon-purple: #8b5cf6;
            --neon-magenta: #ec4899;
            --success-green: #10b981;
            --warning-amber: #f59e0b;
            --danger-red: #ef4444;
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-mono: 'Fira Code', 'Courier New', monospace;
            --grid-unit: 8px;
            --blur-amount: blur(12px);
            --glow-border: 0 0 8px rgba(0, 245, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(to bottom, var(--deep-space-1), var(--deep-space-3));
            color: #e5e7eb;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur-amount);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: var(--glow-border);
            padding: calc(var(--grid-unit) * 2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 16px rgba(0, 245, 255, 0.5);
        }

        /* Hero Section */
        #hero {
            padding: calc(var(--grid-unit) * 4) calc(var(--grid-unit) * 2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        #hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 245, 255, 0.1), transparent);
            animation: pulse 4s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .price-display {
            font-family: var(--font-mono);
            font-size: 4rem;
            font-weight: 600;
            color: var(--electric-cyan);
            text-shadow: 0 0 8px var(--electric-cyan);
            animation: count-up 1s ease-out;
        }

        @keyframes count-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trend-indicator {
            font-size: 1.5rem;
            margin-left: 8px;
            animation: breathe 2s infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Chart Section */
        #chart-section {
            padding: calc(var(--grid-unit) * 2);
        }

        canvas {
            width: 100%;
            height: 300px;
            border-radius: 8px;
            background: var(--deep-space-2);
        }

        /* News Feed */
        #news-feed {
            padding: calc(var(--grid-unit) * 2);
        }

        .news-card {
            display: flex;
            flex-direction: column;
            gap: calc(var(--grid-unit));
            margin-bottom: calc(var(--grid-unit) * 2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .news-card:hover {
            transform: scale(1.02);
        }

        .news-title {
            font-weight: 500;
            color: var(--neon-purple);
        }

        .news-source {
            font-size: 0.875rem;
            color: var(--electric-blue);
        }

        .shimmer {
            background: linear-gradient(90deg, var(--deep-space-2) 0%, var(--deep-space-3) 50%, var(--deep-space-2) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            height: 20px;
            border-radius: 4px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .price-display { font-size: 3rem; }
            canvas { height: 250px; }
        }

        /* Accessibility & Micro-interactions */
        button, a { transition: background 0.2s ease; }
        button:hover { background: rgba(0, 245, 255, 0.1); }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section id="hero" class="glass-card">
        <h1 style="font-size: 2rem; font-weight: 600; margin-bottom: var(--grid-unit);">Grok Oil Price Dashboard</h1>
        <div id="wti-price" class="price-display">$--.-- <span id="wti-trend" class="trend-indicator"></span></div>
        <p id="wti-change" style="font-size: 1.25rem; color: var(--warning-amber);">Loading WTI Crude...</p>
        <div id="brent-price" class="price-display">$--.-- <span id="brent-trend" class="trend-indicator"></span></div>
        <p id="brent-change" style="font-size: 1.25rem; color: var(--warning-amber);">Loading Brent Crude...</p>
        <p id="market-status" style="font-size: 1rem; color: var(--success-green);">Market Status: Loading...</p>
    </section>

    <!-- Chart Section -->
    <section id="chart-section" class="glass-card">
        <h2 style="font-size: 1.5rem; margin-bottom: var(--grid-unit);">WTI Price Chart (1D)</h2>
        <canvas id="price-chart"></canvas>
        <div style="display: flex; justify-content: center; gap: var(--grid-unit); margin-top: var(--grid-unit);">
            <button onclick="updateChart('1d')">1D</button>
            <button onclick="updateChart('5d')">5D</button>
            <button onclick="updateChart('1mo')">1M</button>
            <button onclick="updateChart('3mo')">3M</button>
            <button onclick="updateChart('6mo')">6M</button>
            <button onclick="updateChart('1y')">1Y</button>
        </div>
    </section>

    <!-- News Feed -->
    <section id="news-feed" class="glass-card">
        <h2 style="font-size: 1.5rem; margin-bottom: var(--grid-unit);">Energy News Feed</h2>
        <div id="news-container"></div>
        <div id="news-loading" style="display: flex; flex-direction: column; gap: var(--grid-unit);">
            <div class="shimmer" style="width: 80%;"></div>
            <div class="shimmer" style="width: 60%;"></div>
            <div class="shimmer" style="width: 90%;"></div>
        </div>
    </section>

    <script>
        // Inline JS: Modern ES6+, Clean Modular Structure
        const PROXY = 'https://api.allorigins.win/get?url=';
        const RSS_PROXY = 'https://api.rss2json.com/v1/api.json?rss_url=';
        const SYMBOLS = { wti: 'CL%3DF', brent: 'BZ%3DF' };
        const REUTERS_RSS = 'https://www.reuters.com/arc/outboundfeeds/rss/category/energy/';
        let chartData = {};
        let currentRange = '1d';
        let chartCtx = document.getElementById('price-chart').getContext('2d');
        let priceChart;

        // Utility: Fetch with fallback and error handling
        async function safeFetch(url) {
            try {
                const response = await fetch(PROXY + encodeURIComponent(url));
                if (!response.ok) throw new Error('Network hiccup');
                const data = await response.json();
                return JSON.parse(data.contents);
            } catch (err) {
                console.error('Fetch failed:', err);
                // Fallback: Try another proxy or offline mode
                try {
                    const altResponse = await fetch('https://cors-anywhere.herokuapp.com/' + url); // Note: May need user activation
                    return await altResponse.json();
                } catch {
                    return null; // Graceful degradation
                }
            }
        }

        // Fetch Prices and Update Hero
        async function fetchPrices() {
            const wtiData = await safeFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${SYMBOLS.wti}?range=1d&interval=1m`);
            const brentData = await safeFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${SYMBOLS.brent}?range=1d&interval=1m`);

            if (wtiData) updatePrice('wti', wtiData);
            if (brentData) updatePrice('brent', brentData);

            // Market Status
            const now = new Date();
            const marketOpen = now.getHours() >= 9 && now.getHours() < 16; // Simplified NYSE check
            document.getElementById('market-status').textContent = `Market Status: ${marketOpen ? 'Open' : 'Closed'}`;
            document.getElementById('market-status').style.color = marketOpen ? 'var(--success-green)' : 'var(--danger-red)';
        }

        function updatePrice(symbol, data) {
            const quote = data.chart.result[0].meta;
            const price = quote.regularMarketPrice.toFixed(2);
            const change = ((quote.regularMarketChange / quote.previousClose) * 100).toFixed(2);
            const trend = change > 0 ? '↑' : '↓';
            const color = change > 0 ? 'var(--success-green)' : 'var(--danger-red)';

            const priceEl = document.getElementById(`${symbol}-price`);
            const changeEl = document.getElementById(`${symbol}-change`);
            const trendEl = document.getElementById(`${symbol}-trend`);

            priceEl.innerHTML = `$${price} <span class="trend-indicator" style="color: ${color};">${trend}</span>`;
            changeEl.textContent = `${change}% Today`;
            changeEl.style.color = color;
            trendEl.style.color = color;
        }

        // Fetch Chart Data
        async function fetchChartData(range = '1d') {
            const data = await safeFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${SYMBOLS.wti}?range=${range}&interval=${range === '1d' ? '5m' : '1d'}`);
            if (!data) return;
            const result = data.chart.result[0];
            chartData[range] = {
                timestamps: result.timestamp.map(ts => new Date(ts * 1000).toLocaleTimeString()),
                prices: result.indicators.quote[0].close
            };
            drawChart();
        }

        // Custom Canvas Chart (Simple Line with Gradient)
        function drawChart() {
            const data = chartData[currentRange];
            if (!data) return;

            if (priceChart) priceChart.clearRect(0, 0, chartCtx.canvas.width, chartCtx.canvas.height);

            const w = chartCtx.canvas.width;
            const h = chartCtx.canvas.height;
            const padding = 40;
            const maxPrice = Math.max(...data.prices);
            const minPrice = Math.min(...data.prices);
            const priceRange = maxPrice - minPrice;
            const xStep = (w - padding * 2) / (data.prices.length - 1);
            const yScale = (h - padding * 2) / priceRange;

            // Gradient Fill
            const gradient = chartCtx.createLinearGradient(0, 0, 0, h);
            gradient.addColorStop(0, 'rgba(0, 245, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 245, 255, 0)');

            // Line Path
            chartCtx.beginPath();
            chartCtx.moveTo(padding, h - padding - (data.prices[0] - minPrice) * yScale);
            data.prices.forEach((price, i) => {
                chartCtx.lineTo(padding + i * xStep, h - padding - (price - minPrice) * yScale);
            });
            chartCtx.strokeStyle = 'var(--electric-cyan)';
            chartCtx.lineWidth = 2;
            chartCtx.stroke();

            // Area Fill
            chartCtx.lineTo(w - padding, h - padding);
            chartCtx.lineTo(padding, h - padding);
            chartCtx.closePath();
            chartCtx.fillStyle = gradient;
            chartCtx.fill();

            // Axes (Simplified)
            chartCtx.strokeStyle = 'rgba(255,255,255,0.2)';
            chartCtx.beginPath();
            chartCtx.moveTo(padding, padding);
            chartCtx.lineTo(padding, h - padding);
            chartCtx.lineTo(w - padding, h - padding);
            chartCtx.stroke();
        }

        // Update Chart Range
        function updateChart(range) {
            currentRange = range;
            if (!chartData[range]) fetchChartData(range);
            else drawChart();
        }

        // Fetch News
        async function fetchNews() {
            const data = await safeFetch(RSS_PROXY + encodeURIComponent(REUTERS_RSS));
            if (!data || !data.items) return;
            const container = document.getElementById('news-container');
            container.innerHTML = '';
            document.getElementById('news-loading').style.display = 'none';
            data.items.slice(0, 10).forEach(item => {
                const card = document.createElement('div');
                card.className = 'news-card glass-card';
                card.innerHTML = `
                    <h3 class="news-title">${item.title}</h3>
                    <p>${item.description.substring(0, 150)}...</p>
                    <span class="news-source">${item.author || 'Reuters'} - ${new Date(item.pubDate).toLocaleDateString()}</span>
                    <a href="${item.link}" target="_blank" style="color: var(--neon-magenta);">Read More</a>
                `;
                container.appendChild(card);
            });
        }

        // Init: Pull-to-refresh simulation (touch events)
        function initGestures() {
            let startY;
            document.addEventListener('touchstart', e => startY = e.touches[0].clientY);
            document.addEventListener('touchmove', e => {
                if (e.touches[0].clientY - startY > 50) {
                    fetchPrices();
                    fetchNews();
                    updateChart(currentRange);
                }
            });
        }

        // LocalStorage Caching
        function cacheData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getCached(key) {
            return JSON.parse(localStorage.getItem(key));
        }

        // Progressive Web App Setup
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(new URL('', import.meta.url), { type: 'module' }); // Placeholder for actual SW if needed
        }

        // Load on Init
        window.onload = () => {
            fetchPrices();
            fetchChartData('1d');
            fetchNews();
            initGestures();
            // Refresh every 5min
            setInterval(() => { fetchPrices(); fetchNews(); }, 300000);
        };

        // Resize Chart on Window Resize
        window.addEventListener('resize', drawChart);
    </script>
</body>
</html>