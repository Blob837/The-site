<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Oil Market Terminal - Rick's Rig</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400&display=swap');
        body { margin: 0; padding: 0; background: #000; font-family: 'JetBrains Mono', monospace; color: #00ff00; overflow: hidden; }
        #monitor { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        #bezel { width: 90vmin; height: 67.5vmin; border: 3vmin solid #333; border-radius: 1vmin; position: relative; overflow: hidden; box-shadow: 0 0 2vmin #00ff00; }
        #crt { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; }
        #crt.off { opacity: 0.3; }
        #crt:before { content: ''; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%); background-size: 100% 8px; z-index: 2; pointer-events: none; }
        .scanline { width: 100%; height: 100px; z-index: 8; background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255,255,255,0.2) 10%, rgba(0,0,0,0.1) 100%); opacity: 0.1; position: absolute; bottom: 100%; animation: scanline 10s linear infinite; }
        @keyframes scanline { 0% { bottom: 100%; } 80% { bottom: 100%; } 100% { bottom: 0%; } }
        .terminal { font-family: 'JetBrains Mono', monospace; text-transform: uppercase; padding: 2vmin; height: 100%; overflow-y: auto; line-height: 1.2; }
        .panel { margin-bottom: 2vmin; padding: 1vmin; border: 1px solid #00ff00; background: rgba(0,255,0,0.05); }
        #chart-canvas { width: 100%; height: 30vmin; background: #000; border: 1px solid #00ff00; }
        .price { font-weight: bold; color: #00ff00; }
        .up { color: #00ff00; }
        .down { color: #ff0000; }
        .alert { color: #ffaa00; animation: glow 1s infinite alternate; }
        @keyframes glow { from { text-shadow: 0 0 5px #ffaa00; } to { text-shadow: 0 0 20px #ffaa00; } }
        /* CRT flicker */
        #crt { animation: flicker 0.15s infinite; }
        @keyframes flicker { 0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; } 20%, 24%, 55% { opacity: 0.4; } }
    </style>
</head>
<body>
    <div id="monitor">
        <div id="bezel">
            <div id="crt" onclick="togglePower()">
                <div class="scanline"></div>
                <div class="terminal">
                    <div class="panel" id="header">
                        <h2>RICK'S OIL RIG TERMINAL - SEPT 24, 2025</h2>
                        <p>BOOTING... LIVE FEED ACTIVE. NO LEAKS DETECTED.</p>
                    </div>
                    <div class="panel" id="prices-panel">
                        <h3>LIVE PRICES (USD)</h3>
                        <div id="live-prices"></div>
                    </div>
                    <canvas id="chart-canvas"></canvas>
                    <div class="panel" id="indicators-panel">
                        <h3>TECH INDICATORS (WTI 14-PERIOD)</h3>
                        <div id="indicators"></div>
                    </div>
                    <div class="panel" id="news-panel">
                        <h3>NEWS FEED (OIL)</h3>
                        <div id="news"></div>
                        <p><em>ADD NEWSAPI KEY FOR FULL ACCESS</em></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let powerOn = true;
        function togglePower() { document.getElementById('crt').classList.toggle('off'); powerOn = !powerOn; }

        const symbols = {
            wti: 'CL=F', brent: 'BZ=F', gas: 'NG=F', vix: '^VIX', gold: 'GC=F',
            eur: 'EURUSD=X', cny: 'USDCNY=X', xom: 'XOM', cvx: 'CVX', cop: 'COP', slb: 'SLB'
        };

        const dataCache = {};
        let chartData = []; // For WTI OHLC

        // Fetch function
        async function fetchYahoo(symbol) {
            try {
                const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1m&range=1d`;
                const res = await fetch(url);
                const json = await res.json();
                const result = json.chart.result[0];
                if (!result) return null;
                const quotes = result.indicators.quote[0];
                const timestamps = result.timestamp;
                const latest = {
                    open: quotes.open[quotes.open.length - 1],
                    high: quotes.high[quotes.high.length - 1],
                    low: quotes.low[quotes.low.length - 1],
                    close: quotes.close[quotes.close.length - 1],
                    volume: quotes.volume[quotes.volume.length - 1],
                    change: quotes.close[quotes.close.length - 1] - quotes.close[quotes.close.length - 2] || 0
                };
                // Historical for chart (last 50 bars)
                if (symbol === symbols.wti) {
                    chartData = timestamps.slice(-50).map((t, i) => ({
                        x: new Date(t * 1000),
                        o: quotes.open[i + timestamps.length - 50],
                        h: quotes.high[i + timestamps.length - 50],
                        l: quotes.low[i + timestamps.length - 50],
                        c: quotes.close[i + timestamps.length - 50]
                    }));
                }
                return latest;
            } catch (e) { console.error('Feed busted:', e); return null; }
        }

        // Indicators
        function sma(prices, period) {
            return prices.slice(-period).reduce((a, b) => a + b, 0) / period;
        }

        function ema(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            return ema;
        }

        function calculateRSI(closes, period = 14) {
            if (closes.length < period + 1) return 50;
            let gains = 0, losses = 0;
            for (let i = closes.length - period; i < closes.length; i++) {
                const change = closes[i] - closes[i - 1];
                if (change > 0) gains += change; else losses -= change;
            }
            const avgGain = gains / period;
            const avgLoss = losses / period;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function calculateMACD(closes, fast = 12, slow = 26, signal = 9) {
            const emaFast = ema(closes, fast);
            const emaSlow = ema(closes, slow);
            const macd = emaFast - emaSlow;
            // Simplified histogram
            return { macd, signal: ema([macd], signal) };
        }

        function calculateBollingerBands(closes, period = 20, stdDev = 2) {
            const smaVal = sma(closes, period);
            let variance = 0;
            for (let i = closes.length - period; i < closes.length; i++) {
                variance += Math.pow(closes[i] - smaVal, 2);
            }
            const std = Math.sqrt(variance / period);
            return { upper: smaVal + std * stdDev, lower: smaVal - std * stdDev, middle: smaVal };
        }

        // Draw candlestick
        function drawCandlestick(canvas, data) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!data || data.length < 2) return;

            const padding = 20;
            const width = (canvas.width - padding * 2) / data.length;
            const minPrice = Math.min(...data.map(d => d.l));
            const maxPrice = Math.max(...data.map(d => d.h));
            const priceRange = maxPrice - minPrice;
            const height = canvas.height - padding * 2;

            data.forEach((bar, i) => {
                const x = padding + i * width;
                const openY = canvas.height - padding - ((bar.o - minPrice) / priceRange) * height;
                const closeY = canvas.height - padding - ((bar.c - minPrice) / priceRange) * height;
                const highY = canvas.height - padding - ((bar.h - minPrice) / priceRange) * height;
                const lowY = canvas.height - padding - ((bar.l - minPrice) / priceRange) * height;
                const bodyTop = Math.min(openY, closeY);
                const bodyBottom = Math.max(openY, closeY);
                const bodyHeight = bodyBottom - bodyTop;

                // Wick
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(x + width / 2, highY);
                ctx.lineTo(x + width / 2, lowY);
                ctx.stroke();

                // Body
                if (bar.c >= bar.o) {
                    ctx.fillStyle = '#00ff00'; // Green
                } else {
                    ctx.fillStyle = '#ff0000'; // Red
                }
                ctx.fillRect(x + width / 4, bodyTop, width / 2, bodyHeight);
            });

            // Overlay indicators (simple lines)
            const closes = data.map(d => d.c);
            const rsi = calculateRSI(closes);
            const macd = calculateMACD(closes);
            const bb = calculateBollingerBands(closes);

            // Draw RSI line (simplified, as horizontal for latest)
            ctx.strokeStyle = '#ffff00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding - (rsi / 100) * height / 2); // Scaled
            ctx.lineTo(canvas.width - padding, canvas.height - padding - (rsi / 100) * height / 2);
            ctx.stroke();

            // Update text
            document.getElementById('indicators').innerHTML = `
                RSI: ${rsi.toFixed(2)} | MACD: ${macd.macd.toFixed(2)} | BB Upper: ${bb.upper.toFixed(2)} Lower: ${bb.lower.toFixed(2)}
            `;
        }

        // Update prices
        async function updatePrices() {
            const pricesDiv = document.getElementById('live-prices');
            let html = '';
            for (let [name, sym] of Object.entries(symbols)) {
                const data = await fetchYahoo(sym);
                if (data) {
                    const cls = data.change >= 0 ? 'up' : 'down';
                    html += `<p>${name.toUpperCase()}: $${data.close?.toFixed(2)} <span class="${cls}">${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}</span></p>`;
                }
            }
            pricesDiv.innerHTML = html;
        }

        // Update news (placeholder)
        async function updateNews() {
            const apiKey = 'YOUR_NEWSAPI_KEY_HERE'; // Get free at newsapi.org
            if (apiKey === 'YOUR_NEWSAPI_KEY_HERE') return;
            try {
                const url = `https://newsapi.org/v2/everything?q=oil&apiKey=${apiKey}`;
                const res = await fetch(url);
                const json = await res.json();
                const newsDiv = document.getElementById('news');
                newsDiv.innerHTML = json.articles.slice(0, 5).map(a => `<p>${a.title}</p>`).join('');
            } catch (e) { console.error('News feed dry:', e); }
        }

        // Main loop
        async function update() {
            if (!powerOn) return;
            await updatePrices();
            drawCandlestick(document.getElementById('chart-canvas'), chartData);
            await updateNews();
        }

        setInterval(update, 10000); // 10s refresh - adaptive for market hours if you wanna fancy it
        update(); // Initial boot
    </script>
</body>
</html>