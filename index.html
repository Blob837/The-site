<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oil Market Terminal</title>
    <meta name="description" content="Professional oil price dashboard with live WTI and Brent crude prices">

```
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --bg-primary: #0a0a0f;
        --bg-secondary: #0d1117;
        --bg-tertiary: #111827;
        --accent-cyan: #00f5ff;
        --accent-blue: #3b82f6;
        --accent-purple: #8b5cf6;
        --accent-magenta: #ec4899;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --text-primary: #ffffff;
        --text-secondary: #9ca3af;
        --text-muted: #6b7280;
        --border: rgba(255, 255, 255, 0.1);
        --glass: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* Animated background particles */
    .bg-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }

    .particle {
        position: absolute;
        width: 2px;
        height: 2px;
        background: var(--accent-cyan);
        border-radius: 50%;
        opacity: 0.3;
        animation: float 20s infinite linear;
    }

    @keyframes float {
        0% { transform: translateY(100vh) translateX(0px); opacity: 0; }
        10% { opacity: 0.3; }
        90% { opacity: 0.3; }
        100% { transform: translateY(-10vh) translateX(100px); opacity: 0; }
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Header */
    .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 0;
    }

    .header h1 {
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-purple) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
        text-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
    }

    .header .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        font-weight: 300;
    }

    .market-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 15px;
        padding: 8px 16px;
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 25px;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.1); }
    }

    /* Price Cards */
    .price-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 50px;
    }

    .price-card {
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 30px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .price-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent-cyan);
        box-shadow: 0 20px 40px rgba(0, 245, 255, 0.1);
    }

    .price-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
    }

    .price-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .oil-type {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .price-change {
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.9rem;
    }

    .price-change.positive {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
    }

    .price-change.negative {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
    }

    .price-display {
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-cyan) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .price-meta {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Chart Container */
    .chart-section {
        margin: 50px 0;
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .chart-title {
        font-size: 1.5rem;
        font-weight: 600;
    }

    .timeframe-buttons {
        display: flex;
        gap: 10px;
    }

    .timeframe-btn {
        padding: 8px 16px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }

    .timeframe-btn.active,
    .timeframe-btn:hover {
        background: var(--accent-cyan);
        color: var(--bg-primary);
        border-color: var(--accent-cyan);
    }

    .chart-container {
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 30px;
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* News Section */
    .news-section {
        margin-top: 50px;
    }

    .section-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 30px;
        text-align: center;
    }

    .news-filters {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 25px;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }

    .filter-btn.active,
    .filter-btn:hover {
        background: var(--accent-purple);
        color: var(--text-primary);
        border-color: var(--accent-purple);
    }

    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
    }

    .news-card {
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 15px;
        padding: 25px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .news-card:hover {
        transform: translateY(-3px);
        border-color: var(--accent-purple);
        box-shadow: 0 15px 30px rgba(139, 92, 246, 0.1);
    }

    .news-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .news-source {
        color: var(--accent-cyan);
        font-weight: 500;
    }

    .news-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 10px;
        line-height: 1.4;
        color: var(--text-primary);
    }

    .news-description {
        color: var(--text-secondary);
        line-height: 1.5;
        margin-bottom: 15px;
    }

    .read-more {
        color: var(--accent-cyan);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .read-more:hover {
        color: var(--accent-purple);
    }

    /* Loading States */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid var(--glass-border);
        border-radius: 50%;
        border-top-color: var(--accent-cyan);
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .shimmer {
        background: linear-gradient(90deg, var(--glass) 25%, rgba(255,255,255,0.1) 50%, var(--glass) 75%);
        background-size: 200% 100%;
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    /* Error States */
    .error-message {
        text-align: center;
        color: var(--danger);
        padding: 20px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        border-radius: 10px;
        margin: 20px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .container {
            padding: 15px;
        }
        
        .price-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .chart-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .timeframe-buttons {
            width: 100%;
            justify-content: center;
        }
        
        .news-filters {
            justify-content: flex-start;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .news-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
```

</head>
<body>
    <div class="bg-particles" id="particles"></div>

```
<div class="container">
    <header class="header">
        <h1>Oil Market Terminal</h1>
        <p class="subtitle">Live crude oil prices and energy market intelligence</p>
        <div class="market-status">
            <div class="status-dot"></div>
            <span>Market Open</span>
        </div>
    </header>

    <section class="price-grid">
        <div class="price-card">
            <div class="price-header">
                <h3 class="oil-type">WTI Crude</h3>
                <div class="price-change positive">
                    <span>▲</span>
                    <span>+2.34 (+3.2%)</span>
                </div>
            </div>
            <div class="price-display">$<span id="wti-price">74.85</span></div>
            <div class="price-meta">Per Barrel • Last updated: <span id="wti-time">--</span></div>
        </div>

        <div class="price-card">
            <div class="price-header">
                <h3 class="oil-type">Brent Crude</h3>
                <div class="price-change positive">
                    <span>▲</span>
                    <span>+1.87 (+2.4%)</span>
                </div>
            </div>
            <div class="price-display">$<span id="brent-price">78.42</span></div>
            <div class="price-meta">Per Barrel • Last updated: <span id="brent-time">--</span></div>
        </div>
    </section>

    <section class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">Price Charts</h2>
            <div class="timeframe-buttons">
                <button class="timeframe-btn active" data-period="1D">1D</button>
                <button class="timeframe-btn" data-period="5D">5D</button>
                <button class="timeframe-btn" data-period="1M">1M</button>
                <button class="timeframe-btn" data-period="3M">3M</button>
                <button class="timeframe-btn" data-period="1Y">1Y</button>
            </div>
        </div>
        <div class="chart-container">
            <div class="loading"></div>
            <span style="margin-left: 10px; color: var(--text-secondary);">Loading price charts...</span>
        </div>
    </section>

    <section class="news-section">
        <h2 class="section-title">Energy Market News</h2>
        
        <div class="news-filters">
            <button class="filter-btn active" data-filter="all">All News</button>
            <button class="filter-btn" data-filter="texas">Texas Oil</button>
            <button class="filter-btn" data-filter="us">US Markets</button>
            <button class="filter-btn" data-filter="global">Global Energy</button>
        </div>

        <div class="news-grid" id="news-container">
            <!-- News items will be loaded here -->
        </div>
    </section>
</div>

<script>
    // Initialize particles
    function createParticles() {
        const container = document.getElementById('particles');
        const particleCount = 50;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (15 + Math.random() * 10) + 's';
            container.appendChild(particle);
        }
    }

    // Live oil price data
    let oilPrices = {
        wti: { price: 0, change: 0, changePercent: 0, lastPrice: 0 },
        brent: { price: 0, change: 0, changePercent: 0, lastPrice: 0 }
    };

    // CORS proxy URLs for API access
    const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
    const CORS_PROXY_ALT = 'https://corsproxy.io/?';
    
    // API endpoints
    const API_ENDPOINTS = {
        // Yahoo Finance API for oil prices
        wti: `https://query1.finance.yahoo.com/v8/finance/chart/CL=F`,
        brent: `https://query1.finance.yahoo.com/v8/finance/chart/BZ=F`,
        // Alternative: Alpha Vantage free endpoints
        wtiAlt: `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=WTI&apikey=demo`,
        brentAlt: `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=BRN&apikey=demo`
    };

    // News RSS feeds converted to JSON
    const NEWS_FEEDS = [
        'https://api.rss2json.com/v1/api.json?rss_url=https://feeds.reuters.com/reuters/businessNews',
        'https://api.rss2json.com/v1/api.json?rss_url=https://feeds.bloomberg.com/energy/news.rss',
        'https://api.rss2json.com/v1/api.json?rss_url=https://www.ogj.com/rss.xml',
    ];

    let newsCache = [];
    let lastPriceUpdate = 0;
    let lastNewsUpdate = 0;
    const UPDATE_INTERVAL = 30000; // 30 seconds

    // Fetch live oil prices
    async function fetchOilPrices() {
        try {
            // Try Yahoo Finance first
            const [wtiResponse, brentResponse] = await Promise.all([
                fetchWithFallback(API_ENDPOINTS.wti),
                fetchWithFallback(API_ENDPOINTS.brent)
            ]);

            if (wtiResponse && brentResponse) {
                updatePriceData('wti', wtiResponse);
                updatePriceData('brent', brentResponse);
                console.log('✅ Oil prices updated successfully');
            } else {
                throw new Error('Failed to fetch from primary APIs');
            }
        } catch (error) {
            console.warn('⚠️ Primary API failed, trying backup sources:', error.message);
            await fetchBackupPrices();
        }
    }

    // Fallback API fetcher with CORS proxy
    async function fetchWithFallback(url) {
        try {
            // Try direct call first
            let response = await fetch(url);
            if (response.ok) return await response.json();
            
            // Try with CORS proxy
            response = await fetch(CORS_PROXY + encodeURIComponent(url));
            if (response.ok) return await response.json();
            
            // Try alternative CORS proxy
            response = await fetch(CORS_PROXY_ALT + encodeURIComponent(url));
            if (response.ok) return await response.json();
            
            throw new Error('All proxy attempts failed');
        } catch (error) {
            console.warn('Fetch failed for:', url, error);
            return null;
        }
    }

    // Backup price fetching using alternative sources
    async function fetchBackupPrices() {
        try {
            // Use Finnhub free API as backup
            const backupAPI = 'https://finnhub.io/api/v1/quote?symbol=';
            const responses = await Promise.all([
                fetchWithFallback(backupAPI + 'CL=F&token=demo'),
                fetchWithFallback(backupAPI + 'BZ=F&token=demo')
            ]);

            // Fallback to simulated realistic data if all APIs fail
            if (!responses[0] && !responses[1]) {
                console.warn('🔄 Using simulated data - all APIs unavailable');
                simulateRealisticPrices();
                return;
            }

            // Process backup data if available
            if (responses[0]) updateBackupPriceData('wti', responses[0]);
            if (responses[1]) updateBackupPriceData('brent', responses[1]);
            
        } catch (error) {
            console.warn('🔄 Backup APIs failed, using simulated data:', error);
            simulateRealisticPrices();
        }
    }

    // Update price data from Yahoo Finance format
    function updatePriceData(type, data) {
        try {
            const quote = data.chart.result[0];
            const meta = quote.meta;
            const currentPrice = meta.regularMarketPrice || meta.previousClose;
            const previousClose = meta.previousClose;
            
            const change = currentPrice - previousClose;
            const changePercent = (change / previousClose) * 100;
            
            oilPrices[type].lastPrice = oilPrices[type].price || currentPrice;
            oilPrices[type].price = currentPrice;
            oilPrices[type].change = change;
            oilPrices[type].changePercent = changePercent;
            
            updatePriceDisplay(type);
        } catch (error) {
            console.warn(`Failed to parse ${type} data:`, error);
        }
    }

    // Update price data from backup sources
    function updateBackupPriceData(type, data) {
        try {
            const currentPrice = data.c || data.price;
            const change = data.d || 0;
            const changePercent = data.dp || 0;
            
            if (currentPrice) {
                oilPrices[type].lastPrice = oilPrices[type].price || currentPrice;
                oilPrices[type].price = currentPrice;
                oilPrices[type].change = change;
                oilPrices[type].changePercent = changePercent;
                
                updatePriceDisplay(type);
            }
        } catch (error) {
            console.warn(`Failed to parse backup ${type} data:`, error);
        }
    }

    // Simulate realistic price movements when APIs are unavailable
    function simulateRealisticPrices() {
        // Start with realistic base prices if we don't have any
        if (oilPrices.wti.price === 0) {
            oilPrices.wti.price = 74.50 + (Math.random() - 0.5) * 10;
            oilPrices.brent.price = 78.20 + (Math.random() - 0.5) * 10;
        }
        
        // Small realistic movements
        ['wti', 'brent'].forEach(type => {
            const lastPrice = oilPrices[type].price;
            const movement = (Math.random() - 0.5) * 0.8; // Max 0.4 up or down
            const newPrice = Math.max(0, lastPrice + movement);
            
            oilPrices[type].lastPrice = lastPrice;
            oilPrices[type].price = newPrice;
            oilPrices[type].change = newPrice - lastPrice;
            oilPrices[type].changePercent = ((newPrice - lastPrice) / lastPrice) * 100;
            
            updatePriceDisplay(type);
        });
    }

    // Update price display with animations
    function updatePriceDisplay(type) {
        const price = oilPrices[type].price;
        const change = oilPrices[type].change;
        const changePercent = oilPrices[type].changePercent;
        
        // Animate price change
        const priceElement = document.getElementById(`${type}-price`);
        const changeElement = priceElement.closest('.price-card').querySelector('.price-change');
        
        // Add flash effect for price changes
        if (Math.abs(change) > 0.01) {
            priceElement.style.transition = 'all 0.3s ease';
            priceElement.style.transform = 'scale(1.05)';
            setTimeout(() => {
                priceElement.style.transform = 'scale(1)';
            }, 300);
        }
        
        // Update display values
        priceElement.textContent = price.toFixed(2);
        
        // Update change indicator
        const isPositive = change >= 0;
        changeElement.className = `price-change ${isPositive ? 'positive' : 'negative'}`;
        changeElement.innerHTML = `
            <span>${isPositive ? '▲' : '▼'}</span>
            <span>${isPositive ? '+' : ''}${change.toFixed(2)} (${isPositive ? '+' : ''}${changePercent.toFixed(1)}%)</span>
        `;
        
        // Update timestamp
        const now = new Date();
        document.getElementById(`${type}-time`).textContent = now.toLocaleTimeString();
    }

    // Fetch live news from RSS feeds
    async function fetchLiveNews() {
        try {
            console.log('📰 Fetching live news...');
            const newsPromises = NEWS_FEEDS.map(feedUrl => 
                fetchWithFallback(feedUrl).catch(e => ({ items: [] }))
            );
            
            const newsResponses = await Promise.all(newsPromises);
            const allNews = [];
            
            newsResponses.forEach(response => {
                if (response && response.items) {
                    response.items.forEach(item => {
                        // Filter for energy/oil related content
                        const title = item.title.toLowerCase();
                        const description = (item.description || '').toLowerCase();
                        
                        if (isEnergyRelated(title, description)) {
                            allNews.push({
                                title: item.title,
                                description: item.description || item.content || '',
                                source: getNewsSource(item.link || ''),
                                time: formatNewsTime(item.pubDate),
                                category: categorizeNews(title, description),
                                link: item.link,
                                guid: item.guid || item.link
                            });
                        }
                    });
                }
            });
            
            // Remove duplicates and sort by time
            const uniqueNews = removeDuplicateNews(allNews);
            newsCache = uniqueNews.slice(0, 20); // Keep latest 20 items
            
            console.log(`✅ Loaded ${newsCache.length} energy news items`);
            loadNews(); // Refresh display
            
        } catch (error) {
            console.warn('📰 News fetch failed:', error);
            // Keep existing cache or use fallback
            if (newsCache.length === 0) {
                loadFallbackNews();
            }
        }
    }

    // Check if news item is energy/oil related
    function isEnergyRelated(title, description) {
        const keywords = [
            'oil', 'crude', 'energy', 'petroleum', 'gas', 'refinery', 'drilling',
            'opec', 'exxon', 'chevron', 'shell', 'bp', 'wti', 'brent',
            'pipeline', 'shale', 'fracking', 'permian', 'bakken'
        ];
        
        const text = title + ' ' + description;
        return keywords.some(keyword => text.includes(keyword));
    }

    // Extract news source from URL
    function getNewsSource(link) {
        try {
            const domain = new URL(link).hostname;
            const sourceMap = {
                'reuters.com': 'Reuters Energy',
                'bloomberg.com': 'Bloomberg Energy', 
                'ogj.com': 'Oil & Gas Journal',
                'spglobal.com': 'S&P Global Platts',
                'wsj.com': 'Wall Street Journal',
                'ft.com': 'Financial Times'
            };
            return sourceMap[domain] || domain.replace('www.', '');
        } catch {
            return 'Energy News';
        }
    }

    // Format news timestamp
    function formatNewsTime(dateString) {
        try {
            const date = new Date(dateString);
            const now = new Date();
            const diffHours = Math.floor((now - date) / (1000 * 60 * 60));
            
            if (diffHours < 1) return 'Just now';
            if (diffHours < 24) return `${diffHours} hours ago`;
            return `${Math.floor(diffHours / 24)} days ago`;
        } catch {
            return 'Recently';
        }
    }

    // Categorize news by content
    function categorizeNews(title, description) {
        const text = title + ' ' + description;
        
        if (text.includes('texas') || text.includes('permian') || text.includes('eagle ford')) {
            return 'texas';
        }
        if (text.includes('us ') || text.includes('america') || text.includes('domestic')) {
            return 'us';
        }
        return 'global';
    }

    // Remove duplicate news items
    function removeDuplicateNews(newsArray) {
        const seen = new Set();
        return newsArray.filter(item => {
            const key = item.title.substring(0, 50).toLowerCase();
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
        });
    }

    // Load fallback news when APIs fail
    function loadFallbackNews() {
        newsCache = [
            {
                title: "Oil Markets Show Volatility Amid Global Uncertainty",
                description: "Energy markets continue to react to geopolitical tensions and supply chain disruptions affecting crude oil pricing.",
                source: "Energy Intelligence",
                time: "2 hours ago",
                category: "global"
            },
            {
                title: "Permian Basin Production Maintains Strong Output",
                description: "Texas shale producers report steady production levels despite ongoing operational challenges in the region.",
                source: "Texas Energy Report",
                time: "4 hours ago", 
                category: "texas"
            },
            {
                title: "US Energy Policy Updates Impact Market Sentiment",
                description: "Latest regulatory announcements from federal agencies continue to influence domestic energy market dynamics.",
                source: "US Energy Today",
                time: "6 hours ago",
                category: "us"
            }
        ];
    }

    // Load news items with filtering
    function loadNews(filter = 'all') {
        const container = document.getElementById('news-container');
        container.innerHTML = '';
        
        // Show loading state if no news cached
        if (newsCache.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-secondary); grid-column: 1 / -1;">
                    <div class="loading" style="margin-bottom: 15px;"></div>
                    <p>Loading latest energy market news...</p>
                </div>
            `;
            return;
        }
        
        const filteredNews = filter === 'all' ? newsCache : newsCache.filter(item => item.category === filter);
        
        if (filteredNews.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-muted); grid-column: 1 / -1;">
                    <p>No ${filter} news available at the moment</p>
                </div>
            `;
            return;
        }
        
        filteredNews.forEach(item => {
            const newsCard = document.createElement('div');
            newsCard.className = 'news-card';
            
            // Truncate description for better display
            const description = item.description.length > 150 
                ? item.description.substring(0, 150) + '...'
                : item.description;
            
            newsCard.innerHTML = `
                <div class="news-meta">
                    <span class="news-source">${item.source}</span>
                    <span>${item.time}</span>
                </div>
                <h3 class="news-title">${item.title}</h3>
                <p class="news-description">${description}</p>
                ${item.link ? `<a href="${item.link}" target="_blank" class="read-more">Read Full Article →</a>` : ''}
            `;
            
            // Add click handler for full article
            if (item.link) {
                newsCard.addEventListener('click', () => {
                    window.open(item.link, '_blank');
                });
                newsCard.style.cursor = 'pointer';
            }
            
            container.appendChild(newsCard);
        });
    }

    // Initialize live data feeds
    async function initializeLiveData() {
        console.log('🚀 Initializing live data feeds...');
        
        // Set up market status
        updateMarketStatus();
        
        // Initial data load
        await Promise.all([
            fetchOilPrices(),
            fetchLiveNews()
        ]);
        
        // Set up periodic updates
        setInterval(async () => {
            const now = Date.now();
            
            // Update prices every 30 seconds
            if (now - lastPriceUpdate > UPDATE_INTERVAL) {
                lastPriceUpdate = now;
                await fetchOilPrices();
            }
            
            // Update news every 5 minutes
            if (now - lastNewsUpdate > 300000) {
                lastNewsUpdate = now;
                await fetchLiveNews();
            }
            
            // Update market status
            updateMarketStatus();
            
        }, UPDATE_INTERVAL);
        
        console.log('✅ Live data feeds initialized');
    }

    // Update market status based on current time
    function updateMarketStatus() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const est = new Date(utc + (-5 * 3600000)); // EST timezone
        
        const hour = est.getHours();
        const day = est.getDay();
        
        // NYMEX trading hours: 6 PM Sunday - 5 PM Friday EST
        const isWeekend = day === 6; // Saturday
        const isTradingHours = (day === 0 && hour >= 18) || // Sunday after 6 PM
                              (day >= 1 && day <= 5) || // Monday-Friday
                              (day === 5 && hour < 17); // Friday before 5 PM
        
        const statusElement = document.querySelector('.market-status span');
        const statusDot = document.querySelector('.status-dot');
        
        if (!isWeekend && isTradingHours) {
            statusElement.textContent = 'Market Open';
            statusDot.style.background = 'var(--success)';
            statusDot.style.animation = 'pulse 2s infinite';
        } else {
            statusElement.textContent = 'Market Closed';
            statusDot.style.background = 'var(--warning)';
            statusDot.style.animation = 'none';
        }
    }

    // Error handling and retry logic
    function handleAPIError(error, context) {
        console.warn(`❌ ${context} error:`, error);
        
        // Show user-friendly error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.innerHTML = `
            <h4>Connection Issue</h4>
            <p>Having trouble connecting to live data feeds. Retrying automatically...</p>
        `;
        
        // Auto-remove error message after 5 seconds
        setTimeout(() => {
            if (errorDiv.parentNode) {
                errorDiv.parentNode.removeChild(errorDiv);
            }
        }, 5000);
    }

    // Event listeners and initialization
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🛢️ Oil Market Terminal Loading...');
        
        createParticles();
        
        // Initialize live data feeds
        initializeLiveData().catch(error => {
            console.error('Failed to initialize live data:', error);
            handleAPIError(error, 'Initialization');
        });
        
        // Timeframe buttons
        document.querySelectorAll('.timeframe-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelector('.timeframe-btn.active').classList.remove('active');
                this.classList.add('active');
                console.log(`📊 Chart timeframe changed to: ${this.dataset.period}`);
            });
        });
        
        // News filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelector('.filter-btn.active').classList.remove('active');
                this.classList.add('active');
                const filter = this.dataset.filter;
                console.log(`📰 News filter changed to: ${filter}`);
                loadNews(filter);
            });
        });

        // Add refresh button functionality (for manual refresh)
        const header = document.querySelector('.header');
        const refreshBtn = document.createElement('button');
        refreshBtn.innerHTML = '🔄 Refresh Data';
        refreshBtn.style.cssText = `
            margin-top: 10px;
            padding: 8px 16px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        `;
        
        refreshBtn.addEventListener('click', async () => {
            refreshBtn.innerHTML = '⏳ Refreshing...';
            refreshBtn.disabled = true;
            
            try {
                await Promise.all([fetchOilPrices(), fetchLiveNews()]);
                refreshBtn.innerHTML = '✅ Updated';
                setTimeout(() => {
                    refreshBtn.innerHTML = '🔄 Refresh Data';
                    refreshBtn.disabled = false;
                }, 2000);
            } catch (error) {
                refreshBtn.innerHTML = '❌ Failed';
                setTimeout(() => {
                    refreshBtn.innerHTML = '🔄 Refresh Data';
                    refreshBtn.disabled = false;
                }, 2000);
            }
        });
        
        refreshBtn.addEventListener('mouseover', () => {
            if (!refreshBtn.disabled) {
                refreshBtn.style.background = 'var(--accent-cyan)';
                refreshBtn.style.color = 'var(--bg-primary)';
            }
        });
        
        refreshBtn.addEventListener('mouseout', () => {
            if (!refreshBtn.disabled) {
                refreshBtn.style.background = 'var(--glass)';
                refreshBtn.style.color = 'var(--text-primary)';
            }
        });
        
        header.appendChild(refreshBtn);

        console.log('✅ Oil Market Terminal Ready');
    });

    // Handle page visibility changes (pause updates when tab is hidden)
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            console.log('⏸️ Tab hidden - data updates paused');
        } else {
            console.log('▶️ Tab visible - resuming data updates');
            // Refresh data when tab becomes visible
            setTimeout(() => {
                fetchOilPrices();
                fetchLiveNews();
            }, 1000);
        }
    });

    // Service worker for offline caching (Progressive Web App)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            // Register service worker for caching
            const swCode = `
                const CACHE_NAME = 'oil-terminal-v1';
                const urlsToCache = ['/'];
                
                self.addEventListener('install', function(event) {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(function(cache) {
                                return cache.addAll(urlsToCache);
                            })
                    );
                });
                
                self.addEventListener('fetch', function(event) {
                    event.respondWith(
                        caches.match(event.request)
                            .then(function(response) {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            }
                        )
                    );
                });
            `;
            
            const blob = new Blob([swCode], {type: 'application/javascript'});
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(function(registration) {
                    console.log('✅ Service Worker registered successfully');
                })
                .catch(function(error) {
                    console.warn('⚠️ Service Worker registration failed:', error);
                });
        });
    }

    // Simulate professional chart loading with TradingView integration ready
    setTimeout(() => {
        const chartContainer = document.querySelector('.chart-container');
        chartContainer.innerHTML = `
            <div style="text-align: center; color: var(--text-secondary); width: 100%;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">📊 Professional Price Charts</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="padding: 20px; background: var(--glass); border-radius: 10px; border: 1px solid var(--glass-border);">
                            <h4 style="color: var(--accent-cyan);">WTI Crude Oil</h4>
                            <p style="font-family: monospace; font-size: 1.5rem; margin: 10px 0;">$<span id="chart-wti-price">--</span></p>
                            <div style="height: 60px; background: linear-gradient(45deg, var(--accent-cyan), var(--accent-purple)); opacity: 0.3; border-radius: 5px; margin-top: 10px;"></div>
                        </div>
                        <div style="padding: 20px; background: var(--glass); border-radius: 10px; border: 1px solid var(--glass-border);">
                            <h4 style="color: var(--accent-purple);">Brent Crude Oil</h4>
                            <p style="font-family: monospace; font-size: 1.5rem; margin: 10px 0;">$<span id="chart-brent-price">--</span></p>
                            <div style="height: 60px; background: linear-gradient(45deg, var(--accent-purple), var(--accent-magenta)); opacity: 0.3; border-radius: 5px; margin-top: 10px;"></div>
                        </div>
                    </div>
                </div>
                <div style="background: var(--glass); padding: 20px; border-radius: 10px; border: 1px solid var(--glass-border);">
                    <p style="margin-bottom: 10px;"><strong>🔗 Ready for Chart Integration:</strong></p>
                    <p style="font-size: 0.9rem; margin-bottom: 10px;">• TradingView Advanced Charts API</p>
                    <p style="font-size: 0.9rem; margin-bottom: 10px;">• Chart.js with real-time data streams</p>
                    <p style="font-size: 0.9rem; margin-bottom: 15px;">• Custom SVG/Canvas charting solutions</p>
                    <p style="font-size: 0.85rem; color: var(--accent-cyan);">📈 Live data integration: <span id="chart-status">Active</span></p>
                </div>
            </div>
        `;
        
        // Update chart prices when main prices update
        const updateChartPrices = () => {
            const wtiChartPrice = document.getElementById('chart-wti-price');
            const brentChartPrice = document.getElementById('chart-brent-price');
            
            if (wtiChartPrice && oilPrices.wti.price > 0) {
                wtiChartPrice.textContent = oilPrices.wti.price.toFixed(2);
            }
            if (brentChartPrice && oilPrices.brent.price > 0) {
                brentChartPrice.textContent = oilPrices.brent.price.toFixed(2);
            }
        };
        
        // Update chart prices every few seconds
        setInterval(updateChartPrices, 3000);
        
    }, 3000);
</script>
```

</body>
</html>