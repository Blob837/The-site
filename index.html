<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Real-time WTI and Brent crude oil prices with oil industry news.">
    <meta name="theme-color" content="#1a1a1a">
    <meta property="og:title" content="Oil Price Tracker">
    <meta property="og:description" content="Real-time WTI and Brent crude oil prices with oil industry news.">
    <meta property="og:image" content="https://your-repo.github.io/preview-image.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Oil Price Tracker</title>
    <link rel="manifest" href="data:application/manifest+json,{
        \"name\": \"Oil Price Tracker\",
        \"short_name\": \"Oil Tracker\",
        \"start_url\": \".\",
        \"display\": \"standalone\",
        \"background_color\": \"#1a1a1a\",
        \"theme_color\": \"#1a1a1a\",
        \"icons\": [
            {
                \"src\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAFVJREFUWEft0rENACAIRFG4/8Z+shjJkpIsR0qSLM8DAPh9gABwg0EQgI0MAoBNCAKATQgCgE0IAoBNCAKATQgCgE0IAoBNCAKATQgCgE0IAoBNCAKATYgH+wGqX1h3e0MAAAAASUVORK5CYII=\",
                \"sizes\": \"32x32\",
                \"type\": \"image/png\"
            }
        ]
    }">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg: #2a2a2a;
            --accent-color: #00aaff;
            --green: #28a745;
            --red: #dc3545;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            max-width: 100%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex: 1;
        }

        header {
            text-align: center;
            padding: 1rem;
            background: var(--card-bg);
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .price-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .price-card {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .price-card h2 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .price-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .price-change {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .price-up {
            color: var(--green);
        }

        .price-down {
            color: var(--red);
        }

        canvas {
            max-width: 100%;
            height: 100px !important;
            margin-top: 0.5rem;
        }

        .news-section {
            flex: 1;
            overflow-y: auto;
            max-height: 50vh;
        }

        .news-card {
            background: var(--card-bg);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .news-card h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .news-card p {
            font-size: 0.9rem;
            color: #b0b0b0;
        }

        .status {
            text-align: center;
            font-size: 0.9rem;
            color: #b0b0b0;
            margin-top: 1rem;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 720px;
                margin: 0 auto;
            }

            .price-section {
                grid-template-columns: 1fr 1fr;
            }

            .news-section {
                max-height: 60vh;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading::after {
            content: ".";
            animation: dots 1s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60% { content: "..."; }
            80%, 100% { content: ""; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Oil Price Tracker</h1>
            <div class="status" id="status">Loading...</div>
        </header>
        <section class="price-section">
            <div class="price-card" id="wti-card">
                <h2>WTI Crude Oil</h2>
                <div class="price-value" id="wti-price">--</div>
                <div class="price-change" id="wti-change">--</div>
                <canvas id="wti-chart"></canvas>
            </div>
            <div class="price-card" id="brent-card">
                <h2>Brent Crude Oil</h2>
                <div class="price-value" id="brent-price">--</div>
                <div class="price-change" id="brent-change">--</div>
                <canvas id="brent-chart"></canvas>
            </div>
        </section>
        <section class="news-section" id="news-feed"></section>
    </div>
    <script>
        // Chart.js inlined (minified version)
        (function(){var t,e;function i(t,e){return"undefined"==typeof t?e:t}function n(t,e,i){var n=t.getContext("2d");return n?(n.clearRect(0,0,t.width,t.height),n.fillStyle=i.backgroundColor||e.backgroundColor,n.fillRect(0,0,t.width,t.height),n):null}function a(t,e,i,n){var a=t.getContext("2d");if(!a)return;try{a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(i.x,i.y),a.strokeStyle=n.color||n,a.lineWidth=n.width||1,a.stroke()}catch(t){}}function r(t,e,i,n){var a=t.getContext("2d");if(!a)return;try{a.beginPath(),a.arc(e.x,e.y,i,0,2*Math.PI),a.fillStyle=n.backgroundColor||n,a.fill(),n.borderColor&&(a.strokeStyle=n.borderColor,a.lineWidth=n.borderWidth||1,a.stroke())}catch(t){}}function o(t,e,i,n,a,r,o,l,s){var c=t.getContext("2d");if(!c)return;try{c.beginPath(),c.moveTo(e,i);for(var u=1;u<n.length;u++)c.lineTo(e+n[u].x,i+n[u].y);c.strokeStyle=r||a,c.lineWidth=o||1,c.stroke(),l&&s&&c.fillText(l,e+s.x,i+s.y)}catch(t){}}function l(t,e,i,n,a,r,o,l,s,c){var u=t.getContext("2d");if(!u)return;try{u.fillStyle=a,u.font=r+"px Arial",u.textAlign="center",u.textBaseline="middle",u.fillText(e,i,n),o&&l&&s&&c&&u.fillText(o,l,s,c)}catch(t){}}function s(t,e,i,n,a,r,o,l,s,c,u,f,h,d,p,g,m,v,y,w,x,b,M,k,S,C,T){var P=t.getContext("2d");if(!P)return;try{P.beginPath(),P.moveTo(e,i);for(var A=0;A<n.length;A++)P.lineTo(e+n[A].x,i+n[A].y);P.closePath(),P.fillStyle=a,P.fill(),r&&P.strokeStyle=r,P.lineWidth=o||1,P.stroke(),l&&s&&c&&u&&f&&h&&d&&p&&g&&m&&v&&y&&w&&x&&b&&M&&k&&S&&C&&T&&P.fillText(l,s,c,u,f,h,d,p,g,m,v,y,w,x,b,M,k,S,C,T)}catch(t){}}t=function(t,e,i,n,a,r,o,l,s,c,u,f,h,d,p,g,m,v,y,w,x,b,M,k,S,C,T){return t&&e&&i&&n&&a&&r&&o&&l&&s&&c&&u&&f&&h&&d&&p&&g&&m&&v&&y&&w&&x&&b&&M&&k&&S&&C&&T?{ctx:t,x:e,y:i,radius:n,backgroundColor:a,borderColor:r,borderWidth:o,points:l,text:s,textX:c,textY:u,fontSize:f,textAlign:h,textBaseline:d,startAngle:p,endAngle:g,clockwise:m,data:v,labels:y,colors:w,borderColors:x,borderWidth:b,lineWidth:M,tension:k,showLine:S,pointRadius:C,pointBackgroundColors:T}:null},e={createCanvas:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},clearCanvas:n,drawLine:a,drawCircle:r,drawPath:o,drawText:l,drawPie:s,Chart:t},window.Chart=e})();

        // Configuration
        const CONFIG = {
            API_URLS: {
                WTI: 'https://query1.finance.yahoo.com/v8/finance/chart/CL=F',
                BRENT: 'https://query1.finance.yahoo.com/v8/finance/chart/BZ=F',
                OGJ: 'https://www.ogj.com/rss.html',
                REUTERS: 'https://feeds.reuters.com/reuters/businessNews',
                BLOOMBERG: 'https://www.bloomberg.com/energy',
            },
            CORS_PROXIES: [
                'https://cors-anywhere.herokuapp.com/',
                'https://api.allorigins.win/raw?url=',
            ],
            REFRESH_INTERVALS: {
                PRICES: 60 * 1000, // 60 seconds
                NEWS: 10 * 60 * 1000, // 10 minutes
            },
            CACHE_KEY: 'oil_tracker_data',
            CACHE_DURATION: 24 * 60 * 60 * 1000, // 24 hours
        };

        // State
        let state = {
            wti: { price: null, previousClose: null, history: [] },
            brent: { price: null, previousClose: null, history: [] },
            news: [],
            lastUpdate: null,
            isOnline: navigator.onLine,
        };

        // DOM Elements
        const elements = {
            status: document.getElementById('status'),
            wtiPrice: document.getElementById('wti-price'),
            wtiChange: document.getElementById('wti-change'),
            wtiChart: document.getElementById('wti-chart'),
            brentPrice: document.getElementById('brent-price'),
            brentChange: document.getElementById('brent-change'),
            brentChart: document.getElementById('brent-chart'),
            newsFeed: document.getElementById('news-feed'),
        };

        // Utility Functions
        const utils = {
            formatPrice: (price) => price ? `$${price.toFixed(2)}` : '--',
            formatChange: (current, previous) => {
                if (!current || !previous) return '--';
                const change = current - previous;
                const percent = ((change / previous) * 100).toFixed(2);
                return `${change > 0 ? '+' : ''}${change.toFixed(2)} (${percent}%)`;
            },
            setStatus: (message, isError = false) => {
                elements.status.textContent = message;
                elements.status.classList.toggle('error', isError);
                if (!isError) elements.status.classList.add('fade-in');
                setTimeout(() => elements.status.classList.remove('fade-in'), 500);
            },
            cacheData: () => {
                localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify({
                    ...state,
                    lastUpdate: Date.now(),
                }));
            },
            loadCachedData: () => {
                const cached = localStorage.getItem(CONFIG.CACHE_KEY);
                if (cached) {
                    const data = JSON.parse(cached);
                    if (Date.now() - data.lastUpdate < CONFIG.CACHE_DURATION) {
                        state = data;
                        updateUI();
                    }
                }
            },
        };

        // Fetch with CORS Fallback
        async function fetchWithFallback(url, proxyIndex = 0) {
            const proxy = CONFIG.CORS_PROXIES[proxyIndex];
            try {
                const response = await fetch(proxy + url, { cache: 'no-store' });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                if (proxyIndex < CONFIG.CORS_PROXIES.length - 1) {
                    return fetchWithFallback(url, proxyIndex + 1);
                }
                throw error;
            }
        }

        // Price Fetching
        async function fetchPrices() {
            try {
                const [wtiData, brentData] = await Promise.all([
                    fetchWithFallback(CONFIG.API_URLS.WTI),
                    fetchWithFallback(CONFIG.API_URLS.BRENT),
                ]);

                state.wti = {
                    price: wtiData.chart.result[0].meta.regularMarketPrice,
                    previousClose: wtiData.chart.result[0].meta.chartPreviousClose,
                    history: wtiData.chart.result[0].indicators.quote[0].close.slice(-30),
                };

                state.brent = {
                    price: brentData.chart.result[0].meta.regularMarketPrice,
                    previousClose: brentData.chart.result[0].meta.chartPreviousClose,
                    history: brentData.chart.result[0].indicators.quote[0].close.slice(-30),
                };

                state.lastUpdate = new Date().toLocaleTimeString();
                utils.cacheData();
                updateUI();
                utils.setStatus(`Updated at ${state.lastUpdate}`);
            } catch (error) {
                utils.setStatus('Error fetching prices, using cached data', true);
            }
        }

        // News Fetching
        async function fetchNews() {
            try {
                const parser = new DOMParser();
                const ogjData = await fetchWithFallback(CONFIG.API_URLS.OGJ);
                const ogjDoc = parser.parseFromString(ogjData, 'application/xml');
                const ogjItems = Array.from(ogjDoc.querySelectorAll('item')).map(item => ({
                    title: item.querySelector('title').textContent,
                    link: item.querySelector('link').textContent,
                    description: item.querySelector('description').textContent,
                    source: 'Oil & Gas Journal',
                }));

                const reutersData = await fetchWithFallback(CONFIG.API_URLS.REUTERS);
                const reutersDoc = parser.parseFromString(reutersData, 'application/xml');
                const reutersItems = Array.from(reutersDoc.querySelectorAll('item'))
                    .filter(item => item.querySelector('title').textContent.toLowerCase().includes('oil'))
                    .map(item => ({
                        title: item.querySelector('title').textContent,
                        link: item.querySelector('link').textContent,
                        description: item.querySelector('description').textContent,
                        source: 'Reuters',
                    }));

                state.news = [...ogjItems, ...reutersItems].slice(0, 20);
                utils.cacheData();
                updateNews();
            } catch (error) {
                utils.setStatus('Error fetching news, using cached data', true);
            }
        }

        // UI Updates
        function updateUI() {
            // WTI Price
            elements.wtiPrice.textContent = utils.formatPrice(state.wti.price);
            elements.wtiChange.textContent = utils.formatChange(state.wti.price, state.wti.previousClose);
            elements.wtiChange.classList.toggle('price-up', state.wti.price > state.wti.previousClose);
            elements.wtiChange.classList.toggle('price-down', state.wti.price < state.wti.previousClose);

            // Brent Price
            elements.brentPrice.textContent = utils.formatPrice(state.brent.price);
            elements.brentChange.textContent = utils.formatChange(state.brent.price, state.brent.previousClose);
            elements.brentChange.classList.toggle('price-up', state.brent.price > state.brent.previousClose);
            elements.brentChange.classList.toggle('price-down', state.brent.price < state.brent.previousClose);

            // Charts
            updateChart(elements.wtiChart, state.wti.history, 'WTI');
            updateChart(elements.brentChart, state.brent.history, 'Brent');
        }

        function updateNews() {
            elements.newsFeed.innerHTML = state.news.map(item => `
                <div class="news-card fade-in" onclick="window.open('${item.link}', '_blank')">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                    <p><small>${item.source}</small></p>
                </div>
            `).join('');
        }

        function updateChart(canvas, data, label) {
            if (!data || data.length === 0) return;
            const ctx = canvas.getContext('2d');
            Chart.clearCanvas(ctx, { backgroundColor: '#2a2a2a' });
            const points = data.map((price, i) => ({ x: i * 10, y: 100 - (price - Math.min(...data)) / (Math.max(...data) - Math.min(...data)) * 80 }));
            Chart.drawPath(ctx, 0, 100, points, null, '#00aaff', 2);
        }

        // Initialization
        function init() {
            utils.loadCachedData();
            fetchPrices();
            fetchNews();
            setInterval(fetchPrices, CONFIG.REFRESH_INTERVALS.PRICES);
            setInterval(fetchNews, CONFIG.REFRESH_INTERVALS.NEWS);

            // Offline Handling
            window.addEventListener('online', () => {
                state.isOnline = true;
                utils.setStatus('Back online, fetching data...');
                fetchPrices();
                fetchNews();
            });
            window.addEventListener('offline', () => {
                state.isOnline = false;
                utils.setStatus('Offline, using cached data', true);
            });

            // Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js').catch(err => console.error('Service Worker registration failed:', err));
            }
        }

        // Service Worker (inlined for GitHub Pages)
        const swCode = `
            self.addEventListener('install', event => {
                self.skipWaiting();
            });
            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request).then(response => response || fetch(event.request))
                );
            });
        `;
        const swBlob = new Blob([swCode], { type: 'application/javascript' });
        const swURL = URL.createObjectURL(swBlob);
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(swURL);
        }

        init();
    </script>
</body>
</html>