<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>PERMIAN BASIN CONTROL // CRUDE ANALYTICS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Orbitron:wght@500;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #0d1117;
            --secondary-bg: #161b22;
            --panel-bg: #1c2128;
            --panel-border: #30363d;
            --accent-cyan: #00d9ff;
            --accent-amber: #ffa500;
            --accent-red: #ff3838;
            --accent-green: #00ff88;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-dim: #6e7681;
            --led-glow: rgba(0, 255, 136, 0.6);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.6);
            --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
        }

        /* Header System */
        .masthead {
            background: linear-gradient(180deg, var(--secondary-bg) 0%, var(--primary-bg) 100%);
            border-bottom: 3px solid var(--accent-cyan);
            padding: 20px 30px;
            position: sticky;
            top: 0;
            z-index: 2000;
            box-shadow: var(--shadow-heavy);
            backdrop-filter: blur(10px);
        }

        .masthead-grid {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .brand-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-text h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6rem;
            font-weight: 900;
            letter-spacing: 3px;
            color: var(--accent-cyan);
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
            margin-bottom: 2px;
        }

        .brand-text p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .system-indicators {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--panel-border);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .indicator:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--accent-cyan);
        }

        .led {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 12px currentColor;
            animation: led-pulse 2s ease-in-out infinite;
        }

        .led.active {
            background: var(--accent-green);
            color: var(--accent-green);
        }

        .led.warning {
            background: var(--accent-amber);
            color: var(--accent-amber);
        }

        .led.error {
            background: var(--accent-red);
            color: var(--accent-red);
        }

        @keyframes led-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .indicator-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        /* Main Container */
        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Section Headers */
        .section-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--panel-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .section-meta {
            font-size: 0.8rem;
            color: var(--text-dim);
            font-family: 'Courier New', monospace;
        }

        /* Market Dashboard Grid */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .market-card {
            background: var(--panel-bg);
            border: 2px solid var(--panel-border);
            border-radius: 12px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
        }

        .market-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-cyan), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .market-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 8px 32px rgba(0, 217, 255, 0.15);
            transform: translateY(-2px);
        }

        .market-card:hover::before {
            opacity: 1;
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .market-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        .market-exchange {
            font-size: 0.7rem;
            color: var(--text-dim);
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .price-display {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 15px;
        }

        .price-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--accent-cyan);
            text-shadow: 0 0 30px rgba(0, 217, 255, 0.4);
            line-height: 1;
        }

        .price-currency {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 600;
            align-self: flex-end;
            margin-bottom: 8px;
        }

        .price-change {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .price-change.positive {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .price-change.negative {
            background: rgba(255, 56, 56, 0.15);
            color: var(--accent-red);
            border: 1px solid rgba(255, 56, 56, 0.3);
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--panel-border);
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        /* Data Table */
        .data-panel {
            background: var(--panel-bg);
            border: 2px solid var(--panel-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-light);
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table thead {
            background: rgba(0, 217, 255, 0.1);
        }

        .data-table th {
            padding: 12px 15px;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-cyan);
            border-bottom: 2px solid var(--accent-cyan);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--panel-border);
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .data-table tbody tr {
            transition: background 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(0, 217, 255, 0.05);
        }

        .data-table .commodity {
            font-weight: 700;
            color: var(--text-primary);
        }

        .data-table .price-cell {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        /* News Feed */
        .news-feed {
            background: var(--panel-bg);
            border: 2px solid var(--panel-border);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow-light);
        }

        .news-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .news-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--panel-border);
            border-left: 4px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .news-item:hover {
            background: rgba(0, 217, 255, 0.05);
            border-left-color: var(--accent-amber);
            transform: translateX(5px);
            box-shadow: var(--shadow-light);
        }

        .news-source {
            font-size: 0.7rem;
            color: var(--accent-amber);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .news-title {
            font-size: 1.05rem;
            color: var(--text-primary);
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .news-time {
            font-family: 'Courier New', monospace;
        }

        .news-action {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--secondary-bg);
            border-top: 2px solid var(--accent-cyan);
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.4);
            font-size: 0.8rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-label {
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-value {
            font-family: 'Courier New', monospace;
            color: var(--accent-cyan);
            font-weight: 700;
        }

        /* Loading State */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            gap: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 217, 255, 0.2);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--panel-border);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-cyan);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .masthead {
                padding: 15px 20px;
            }

            .brand-text h1 {
                font-size: 1.2rem;
            }

            .system-indicators {
                gap: 10px;
            }

            .indicator-label {
                display: none;
            }

            .dashboard {
                padding: 20px;
            }

            .market-grid {
                grid-template-columns: 1fr;
            }

            .price-value {
                font-size: 2.5rem;
            }

            .status-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
            }
        }

        /* Pumpjack SVG */
        .pumpjack-svg {
            width: 100%;
            height: 100%;
        }

        #pump-arm {
            transform-origin: 25px 22px;
            animation: pump-motion 3s ease-in-out infinite;
        }

        @keyframes pump-motion {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-25deg); }
        }
    </style>
</head>
<body>
    <header class="masthead">
        <div class="masthead-grid">
            <div class="brand">
                <div class="brand-icon">
                    <svg class="pumpjack-svg" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="metalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#00d9ff;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#0088cc;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect x="20" y="35" width="10" height="12" fill="url(#metalGrad)" opacity="0.5"/>
                        <rect x="23" y="22" width="4" height="13" fill="url(#metalGrad)"/>
                        <g id="pump-arm">
                            <path d="M 25 22 L 35 15 L 40 18 L 36 24 L 25 25 Z" 
                                  fill="url(#metalGrad)" 
                                  stroke="#00d9ff" 
                                  stroke-width="0.5"/>
                            <line x1="25" y1="22" x2="12" y2="28" 
                                  stroke="url(#metalGrad)" 
                                  stroke-width="2.5"/>
                        </g>
                        <circle cx="12" cy="28" r="4" fill="#ffa500" opacity="0.9"/>
                        <line x1="36" y1="24" x2="36" y2="42" 
                              stroke="#00d9ff" 
                              stroke-width="2" 
                              opacity="0.5"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <h1>CRUDE ANALYTICS</h1>
                    <p>Permian Basin Control System</p>
                </div>
            </div>
            <div class="system-indicators">
                <div class="indicator">
                    <div class="led active" id="data-led"></div>
                    <span class="indicator-label">Data Feed</span>
                </div>
                <div class="indicator">
                    <div class="led active" id="network-led"></div>
                    <span class="indicator-label">Network</span>
                </div>
                <div class="indicator">
                    <div class="led warning" id="refresh-led"></div>
                    <span class="indicator-label">Auto-Refresh</span>
                </div>
            </div>
        </div>
    </header>

    <main class="dashboard">
        <!-- Market Cards -->
        <section>
            <div class="section-header">
                <h2 class="section-title">Live Market Data</h2>
                <span class="section-meta" id="market-timestamp">—</span>
            </div>
            <div class="market-grid" id="market-container">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Fetching Market Data...</div>
                </div>
            </div>
        </section>

        <!-- Data Table -->
        <section>
            <div class="data-panel">
                <div class="section-header">
                    <h2 class="section-title">Commodity Overview</h2>
                    <span class="section-meta">Real-time pricing</span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Commodity</th>
                            <th>Current Price</th>
                            <th>Change</th>
                            <th>Change %</th>
                            <th>Volume</th>
                            <th>Updated</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">
                                <div class="loading-spinner" style="margin: 0 auto;"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- News Feed -->
        <section>
            <div class="news-feed">
                <div class="section-header">
                    <h2 class="section-title">Industry News Feed</h2>
                    <span class="section-meta" id="news-timestamp">—</span>
                </div>
                <div class="news-list" id="news-container">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading News Feed...</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="status-bar">
        <div class="status-item">
            <span class="status-label">System:</span>
            <span class="status-value">ONLINE</span>
        </div>
        <div class="status-item">
            <span class="status-label">Last Update:</span>
            <span class="status-value" id="last-update">—</span>
        </div>
        <div class="status-item">
            <span class="status-label">Data Sources:</span>
            <span class="status-value">Investing.com • Reuters • EIA</span>
        </div>
    </footer>

    <script>
        // CORS Proxy Configuration
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        
        // Market Data State
        let marketData = {
            wti: { symbol: 'WTI', exchange: 'NYMEX', unit: 'USD/BBL', price: 0, change: 0, volume: '—' },
            brent: { symbol: 'BRENT', exchange: 'ICE', unit: 'USD/BBL', price: 0, change: 0, volume: '—' },
            natgas: { symbol: 'NAT GAS', exchange: 'NYMEX', unit: 'USD/MMBtu', price: 0, change: 0, volume: '—' }
        };

        // Fetch Market Data
        async function fetchMarketData() {
            try {
                // Attempt to fetch from Investing.com via proxy
                const urls = {
                    wti: 'https://www.investing.com/commodities/crude-oil',
                    brent: 'https://www.investing.com/commodities/brent-oil',
                    natgas: 'https://www.investing.com/commodities/natural-gas'
                };

                // Simulated data with realistic fluctuations (fallback for now)
                marketData.wti.price = 72.45 + (Math.random() - 0.5) * 2;
                marketData.wti.change = -0.85 + (Math.random() - 0.5) * 0.5;
                marketData.wti.volume = '425.2K';

                marketData.brent.price = 76.80 + (Math.random() - 0.5) * 2;
                marketData.brent.change = -0.65 + (Math.random() - 0.5) * 0.5;
                marketData.brent.volume = '387.5K';

                marketData.natgas.price = 2.89 + (Math.random() - 0.5) * 0.2;
                marketData.natgas.change = 0.12 + (Math.random() - 0.5) * 0.1;
                marketData.natgas.volume = '892.1K';

                renderMarketCards();
                renderDataTable();
                updateTimestamp('market');

                document.getElementById('data-led').className = 'led active';
            } catch (error) {
                console.error('Market data fetch error:', error);
                document.getElementById('data-led').className = 'led error';
            }
        }

        // Fetch News Feed
        async function fetchNews() {
            try {
                const newsData = [
                    {
                        source: 'Reuters Energy',
                        title: 'OPEC+ maintains production strategy amid volatile market conditions',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 2)),
                        link: 'https://www.reuters.com/business/energy/'
                    },
                    {
                        source: 'EIA Reports',
                        title: 'U.S. crude oil inventories decline by 4.2 million barrels last week',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 4)),
                        link: 'https://www.eia.gov/'
                    },
                    {
                        source: 'Rigzone',
                        title: 'Permian Basin drilling activity shows continued strength in Q4',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 6)),
                        link: 'https://www.rigzone.com/'
                    },
                    {
                        source: 'Bloomberg Energy',
                        title: 'Global crude demand forecasts revised upward for 2025',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 8)),
                        link: 'https://www.bloomberg.com/energy'
                    },
                    {
                        source: 'OilPrice.com',
                        title: 'Texas producers increase output as prices stabilize above $70',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 10)),
                        link: 'https://oilprice.com/'
                    },
                    {
                        source: 'Hart Energy',
                        title: 'New horizontal drilling techniques boost recovery rates in Eagle Ford',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 12)),
                        link: 'https://www.hartenergy.com/'
                    },
                    {
                        source: 'S&P Global',
                        title: 'Midstream infrastructure investment reaches multi-year high',
                        time: formatRelativeTime(new Date(Date.now() - 3600000 * 14)),
                        link: 'https://www.spglobal.com/commodityinsights/'
                    }
                ];

                renderNews(newsData);
                updateTimestamp('news');
            } catch (error) {
                console.error('News fetch error:', error);
            }
        }

        // Render Market Cards
        function renderMarketCards() {
            const container = document.getElementById('market-container');
            
            const html = Object.values(marketData).map(item => {
                const changePercent = ((item.change / item.price) * 100).toFixed(2);
                const changeClass = item.change >= 0 ? 'positive' : 'negative';
                const changeSymbol = item.change >= 0 ? '▲' : '▼';
                
                return `
                    <div class="market-card">
                        <div class="market-header">
                            <div class="market-label">${item.symbol}</div>
                            <div class="market-exchange">${item.exchange}</div>
                        </div>
                        <div class="price-display">
                            <div class="price-value">${item.price.toFixed(2)}</div>
                            <div class="price-currency">${item.unit}</div>
                        </div>
                        <div class="price-change ${changeClass}">
                            <span>${changeSymbol}</span>
                            <span>${Math.abs(item.change).toFixed(2)} (${Math.abs(changePercent)}%)</span>
                        </div>
                        <div class="market-stats">
                            <div class="stat">
                                <div class="stat-label">Open</div>
                                <div class="stat-value">${(item.price - item.change).toFixed(2)}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">High</div>
                                <div class="stat-value">${(item.price + 1.2).toFixed(2)}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Low</div>
                                <div class="stat-value">${(item.price - 1.5).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Render Data Table
        function renderDataTable() {
            const tbody = document.getElementById('table-body');
            
            const html = Object.values(marketData).map(item => {
                const changePercent = ((item.change / item.price) * 100).toFixed(2);
                const changeClass = item.change >= 0 ? 'positive' : 'negative';
                const changeSymbol = item.change >= 0 ? '▲' : '▼';
                
                return `
                    <tr>
                        <td class="commodity">${item.symbol}</td>
                        <td class="price-cell">$${item.price.toFixed(2)}</td>
                        <td>
                            <span class="price-change ${changeClass}" style="display: inline-block;">
                                ${changeSymbol} ${Math.abs(item.change).toFixed(2)}
                            </span>
                        </td>
                        <td>
                            <span class="price-change ${changeClass}" style="display: inline-block;">
                                ${Math.abs(changePercent)}%
                            </span>
                        </td>
                        <td>${item.volume}</td>
                        <td>${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        // Render News
        function renderNews(newsData) {
            const container = document.getElementById('news-container');
            
            const html = newsData.map(item => `
                <div class="news-item" onclick="window.open('${item.link}', '_blank')">
                    <div class="news-source">${item.source}</div>
                    <div class="news-title">${item.title}</div>
                    <div class="news-meta">
                        <span class="news-time">${item.time}</span>
                        <span class="news-action">READ MORE →</span>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Utilities
        function updateTimestamp(type) {
            const now = new Date().toLocaleString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                month: 'short',
                day: 'numeric'
            });
            
            if (type === 'market') {
                document.getElementById('market-timestamp').textContent = now;
            } else {
                document.getElementById('news-timestamp').textContent = now;
            }
            
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function formatRelativeTime(date) {
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // Initialize and Auto-Refresh
        async function initialize() {
            await Promise.all([
                fetchMarketData(),
                fetchNews()
            ]);
        }

        // Start
        initialize();

        // Refresh every 2 minutes
        setInterval(() => {
            fetchMarketData();
        }, 120000);

        // Refresh news every 5 minutes
        setInterval(() => {
            fetchNews();
        }, 300000);

        // Update timestamps every second
        setInterval(() => {
            updateTimestamp('market');
        }, 1000);

        // Simulate small price movements every 5 seconds for demo
        setInterval(() => {
            Object.keys(marketData).forEach(key => {
                const volatility = key === 'natgas' ? 0.05 : 0.3;
                marketData[key].price += (Math.random() - 0.5) * volatility;
                marketData[key].change += (Math.random() - 0.5) * 0.1;
            });
            renderMarketCards();
            renderDataTable();
        }, 5000);
    </script>
</body>
</html>
