<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Crude Oil Price Tracker</title>
    <style>
/* Minified CSS */
body{font-family:Arial,sans-serif;margin:0;padding:0;background-color:#f4f4f4;color:#333}.container{max-width:1200px;margin:0 auto;padding:20px}.header{text-align:center;margin-bottom:20px}.header h1{font-size:2em;margin:0}.dashboard{display:flex;flex-direction:column;gap:20px}@media (min-width:768px){.dashboard{flex-direction:row;gap:30px}}.price-card{flex:1;background:white;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:20px;text-align:center}.price-title{font-size:1.2em;font-weight:bold;margin-bottom:10px}.price-value{font-size:2.5em;font-weight:bold}.change-positive{color:green}.change-negative{color:red}.timestamp{font-size:.8em;color:#666;margin-top:10px}.market-status{font-size:.9em;font-weight:bold;margin-top:5px}.chart-section{margin-top:30px}.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.chart-header h2{font-size:1.5em;margin:0}.view-buttons button{background:#007bff;color:white;border:none;border-radius:4px;padding:8px 12px;margin:5px;cursor:pointer;font-size:.9em}.view-buttons button.active{background:#0056b3}.chart-container{position:relative;height:300px}.alerts-section{margin-top:30px}.alerts-section h2{font-size:1.5em}.alert-form{display:flex;gap:10px;margin-bottom:10px}.alert-form input{width:100px;padding:5px}.alert-form select{width:80px;padding:5px}.alert-form button{padding:5px 10px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer}.error-message{color:red;text-align:center;margin-top:20px}button{touch-action:manipulation}canvas{touch-action:pan-y}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Crude Oil Price Tracker</h1>
        </div>
        <div class="dashboard">
            <div class="price-card" id="wti-card">
                <div class="price-title">WTI Crude Oil</div>
                <div class="price-value" id="wti-price">--</div>
                <div id="wti-change" class="change">--</div>
                <div class="timestamp" id="wti-timestamp">Last updated: --</div>
                <div class="market-status" id="wti-market-status">Market: --</div>
            </div>
            <div class="price-card" id="brent-card">
                <div class="price-title">Brent Crude Oil</div>
                <div class="price-value" id="brent-price">--</div>
                <div id="brent-change" class="change">--</div>
                <div class="timestamp" id="brent-timestamp">Last updated: --</div>
                <div class="market-status" id="brent-market-status">Market: --</div>
            </div>
        </div>
        <div class="chart-section">
            <div class="chart-header">
                <h2 id="chart-title">WTI 30-Day Chart</h2>
                <div class="view-buttons">
                    <button onclick="changeView('1d')">1D</button>
                    <button onclick="changeView('7d')">7D</button>
                    <button class="active" onclick="changeView('30d')">30D</button>
                </div>
            </div>
            <select id="chart-symbol" onchange="updateChart()">
                <option value="CL=F">WTI</option>
                <option value="BZ=F">Brent</option>
            </select>
            <div class="chart-container">
                <canvas id="price-chart"></canvas>
            </div>
        </div>
        <div class="alerts-section">
            <h2>Price Alerts</h2>
            <div class="alert-form">
                <select id="alert-symbol">
                    <option value="CL=F">WTI</option>
                    <option value="BZ=F">Brent</option>
                </select>
                <input type="number" id="alert-price" placeholder="Price">
                <select id="alert-type">
                    <option value="above">Above</option>
                    <option value="below">Below</option>
                </select>
                <button onclick="setAlert()">Set Alert</button>
            </div>
            <p>Set price thresholds for notifications.</p>
        </div>
        <div id="error-message" class="error-message"></div>
    </div>
    <script>
/* Minified JavaScript with comments for clarity */
// Constants
const symbols=["CL=F","BZ=F"];const names={ "CL=F":"WTI", "BZ=F":"Brent" };const proxy="https://api.allorigins.win/raw?url=";const cacheKey="oilData";const alertKey="oilAlerts";let currentView="30d";let currentSymbol="CL=F";let chart;let dataCache={};let alerts=JSON.parse(localStorage.getItem(alertKey))||[];

// Function to fetch quotes
async function fetchQuotes(){const url=proxy+encodeURIComponent(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(",")}`);try{const res=await fetch(url);if(!res.ok)throw new Error("Network error");const data=await res.json();const results=data.quoteResponse.result;results.forEach(q=>{const id=q.symbol==="CL=F"?"wti": "brent";document.getElementById(`${id}-price`).textContent=`$${q.regularMarketPrice.toFixed(2)}`;const changeEl=document.getElementById(`${id}-change`);const change=q.regularMarketChange.toFixed(2);const pct=q.regularMarketChangePercent.toFixed(2);changeEl.textContent=`${change} (${pct}%)`;changeEl.className=change>0?"change-positive":change<0?"change-negative":"";document.getElementById(`${id}-timestamp`).textContent=`Last updated: ${new Date(q.regularMarketTime*1000).toLocaleString()}`;document.getElementById(`${id}-market-status`).textContent=`Market: ${q.marketState}`;dataCache[q.symbol]={price:q.regularMarketPrice,change:q.regularMarketChange,pct:q.regularMarketChangePercent,time:q.regularMarketTime,state:q.marketState};checkAlerts(q.symbol,q.regularMarketPrice)});localStorage.setItem(cacheKey,JSON.stringify(dataCache));document.getElementById("error-message").textContent=""}catch(err){document.getElementById("error-message").textContent="Error fetching data. Using cached data if available."}}

// Function to fetch historical data
async function fetchHistorical(symbol,view){let range="1mo",interval="1d";if(view==="1d"){range="1d";interval="1m"}else if(view==="7d"){range="5d";interval="5m"}const url=proxy+encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=${range}&interval=${interval}&includeTimestamps=true`);try{const res=await fetch(url);if(!res.ok)throw new Error("Network error");const data=await res.json();const timestamps=data.chart.result[0].timestamp;const closes=data.chart.result[0].indicators.quote[0].close;return timestamps.map((t,i)=>({time:new Date(t*1000),price:closes[i]}))}catch(err){return dataCache[symbol]?.historical||[]}} 

// Initialize chart
function initChart(){const ctx=document.getElementById("price-chart").getContext("2d");chart=new Chart(ctx,{type:"line",data:{datasets:[{label:"Price",data:[],borderColor:"rgb(75, 192, 192)",tension:0.1}]},options:{scales:{x:{type:"time",time:{unit:"day"}},y:{beginAtZero:false}},plugins:{zoom:{zoom:{wheel:{enabled:true},pinch:{enabled:true},mode:"xy"},pan:{enabled:true,mode:"xy"}}}}})} 

// Update chart
async function updateChart(){const historical=await fetchHistorical(currentSymbol,currentView);chart.data.datasets[0].data=historical.map(d=>({x:d.time,y:d.price}));chart.update();document.getElementById("chart-title").textContent=`${names[currentSymbol]} ${currentView.toUpperCase()} Chart`;dataCache[currentSymbol]={...dataCache[currentSymbol]||{},historical}}

// Change view
function changeView(view){currentView=view;document.querySelectorAll(".view-buttons button").forEach(b=>b.classList.toggle("active",b.textContent===view.toUpperCase()));updateChart()}

// Set alert
function setAlert(){const symbol=document.getElementById("alert-symbol").value;const price=parseFloat(document.getElementById("alert-price").value);const type=document.getElementById("alert-type").value;if(isNaN(price))return;alerts.push({symbol,price,type});localStorage.setItem(alertKey,JSON.stringify(alerts));Notification.requestPermission()} 

// Check alerts
function checkAlerts(symbol,price){alerts.forEach((a,i)=>{if(a.symbol===symbol){const triggered=(a.type==="above"&&price>a.price)||(a.type==="below"&&price<a.price);if(triggered){new Notification(`${names[symbol]} Alert`,`Price ${a.type} ${a.price}: Current ${price}`);alerts.splice(i,1);localStorage.setItem(alertKey,JSON.stringify(alerts))}})}

// Load cached data
function loadCached(){const cached=localStorage.getItem(cacheKey);if(cached){dataCache=JSON.parse(cached);Object.keys(dataCache).forEach(s=>{const id=s==="CL=F"?"wti":"brent";const d=dataCache[s];document.getElementById(`${id}-price`).textContent=`$${d.price.toFixed(2)}`;const changeEl=document.getElementById(`${id}-change`);changeEl.textContent=`${d.change.toFixed(2)} (${d.pct.toFixed(2)}%)`;changeEl.className=d.change>0?"change-positive":d.change<0?"change-negative":"";document.getElementById(`${id}-timestamp`).textContent=`Last updated: ${new Date(d.time*1000).toLocaleString()} (cached)`;document.getElementById(`${id}-market-status`).textContent=`Market: ${d.state}`})}}

// Event listeners
document.getElementById("chart-symbol").addEventListener("change",e=>{currentSymbol=e.target.value;updateChart()}); 

// Init
async function init(){loadCached();initChart();await fetchQuotes();await updateChart();setInterval(fetchQuotes,900000)}init();
    </script>
</body>
</html>
