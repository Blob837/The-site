<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WTI Oil Tracker</title>
    <meta name="description" content="Real-time WTI oil prices and industry news for oil field professionals">
    <meta name="keywords" content="WTI, oil prices, crude oil, energy news, petroleum">
    <meta property="og:title" content="WTI Oil Price Tracker">
    <meta property="og:description" content="Production-grade oil price tracker for field professionals">
    <meta property="og:type" content="website">

```
<!-- PWA Manifest -->
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiV1RJIE9pbCBUcmFja2VyIiwic2hvcnRfbmFtZSI6IldUSSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWEyMjMzIiwidGhlbWVfY29sb3IiOiIjZmY2NjAwIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qUWlJR2hsYVdkb2REMGlNalFpSUhabGNuTnBiMjQ5SWpFdU1TSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNEthbkpsWTNRZ2VEMGlNaUlnZVQwaU1pSWdkMmxrZEdnOUlqSXdJaUJvWldsbmFIUTlJakl3SWlCbWFXeHNQU0lqWm1ZMk5qQXdJaTgrUEM5emRtYysiLCJzaXplcyI6IjI0eDI0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
<meta name="theme-color" content="#1a2233">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --bg-primary: #0f1419;
        --bg-secondary: #1a2233;
        --bg-tertiary: #242d3d;
        --text-primary: #ffffff;
        --text-secondary: #b8c5d1;
        --text-muted: #7d8590;
        --accent-orange: #ff6600;
        --accent-green: #28a745;
        --accent-red: #dc3545;
        --border-color: #30363d;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        --radius: 8px;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .container {
        max-width: 100%;
        padding: 0 16px;
        margin: 0 auto;
    }

    .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: 16px 0;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        font-size: 20px;
        font-weight: 700;
        color: var(--accent-orange);
        display: flex;
        align-items: center;
    }

    .logo::before {
        content: "âš¡";
        margin-right: 8px;
        font-size: 24px;
    }

    .status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--text-muted);
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent-green);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .price-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin: 24px 0;
    }

    .price-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow);
        transition: transform 0.2s ease;
    }

    .price-card:active {
        transform: scale(0.98);
    }

    .price-label {
        font-size: 14px;
        color: var(--text-muted);
        margin-bottom: 8px;
        font-weight: 600;
    }

    .price-value {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        font-variant-numeric: tabular-nums;
    }

    .price-change {
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }

    .price-up {
        color: var(--accent-green);
    }

    .price-down {
        color: var(--accent-red);
    }

    .chart-container {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 20px;
        margin: 24px 0;
        box-shadow: var(--shadow);
    }

    .chart-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--text-secondary);
    }

    .mini-chart {
        width: 100%;
        height: 120px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        position: relative;
        overflow: hidden;
    }

    .chart-line {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .news-section {
        margin: 32px 0;
    }

    .section-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 16px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .section-title::before {
        content: "ðŸ“°";
        font-size: 16px;
    }

    .news-grid {
        display: grid;
        gap: 16px;
    }

    .news-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 16px;
        box-shadow: var(--shadow);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .news-card:hover,
    .news-card:active {
        border-color: var(--accent-orange);
        transform: translateY(-2px);
    }

    .news-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        line-height: 1.4;
        color: var(--text-primary);
    }

    .news-meta {
        font-size: 12px;
        color: var(--text-muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .news-source {
        font-weight: 600;
    }

    .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
        color: var(--text-muted);
    }

    .loading::after {
        content: "";
        width: 20px;
        height: 20px;
        margin-left: 10px;
        border: 2px solid var(--text-muted);
        border-top: 2px solid var(--accent-orange);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error {
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid var(--accent-red);
        border-radius: var(--radius);
        padding: 16px;
        margin: 16px 0;
        color: var(--accent-red);
        text-align: center;
    }

    .offline-indicator {
        background: var(--accent-red);
        color: white;
        padding: 8px 16px;
        text-align: center;
        font-size: 14px;
        font-weight: 600;
    }

    .refresh-button {
        background: var(--accent-orange);
        color: white;
        border: none;
        border-radius: var(--radius);
        padding: 12px 24px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
        margin: 16px auto;
        display: block;
        font-size: 14px;
    }

    .refresh-button:hover {
        background: #e55a00;
    }

    .refresh-button:active {
        transform: scale(0.98);
    }

    .last-updated {
        text-align: center;
        color: var(--text-muted);
        font-size: 12px;
        margin: 16px 0;
    }

    @media (max-width: 480px) {
        .price-grid {
            grid-template-columns: 1fr;
        }
        
        .price-value {
            font-size: 24px;
        }
        
        .container {
            padding: 0 12px;
        }
    }

    @media (min-width: 768px) {
        .container {
            max-width: 768px;
        }
        
        .news-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
    }
</style>
```

</head>
<body>
    <div class="offline-indicator" id="offlineIndicator" style="display: none;">
        ðŸ“¡ Offline Mode - Using Cached Data
    </div>

```
<header class="header">
    <div class="container">
        <div class="header-content">
            <div class="logo">WTI Tracker</div>
            <div class="status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Live</span>
            </div>
        </div>
    </div>
</header>

<main class="container">
    <div class="price-grid">
        <div class="price-card">
            <div class="price-label">WTI Crude Oil</div>
            <div class="price-value" id="wtiPrice">--</div>
            <div class="price-change" id="wtiChange">--</div>
        </div>
        <div class="price-card">
            <div class="price-label">Brent Crude</div>
            <div class="price-value" id="brentPrice">--</div>
            <div class="price-change" id="brentChange">--</div>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-title">WTI Price Trend (24h)</div>
        <div class="mini-chart" id="miniChart">
            <canvas class="chart-line" id="chartCanvas" width="300" height="120"></canvas>
        </div>
    </div>

    <button class="refresh-button" id="refreshButton">
        ðŸ”„ Refresh Data
    </button>

    <div class="last-updated" id="lastUpdated">
        Last updated: --
    </div>

    <section class="news-section">
        <h2 class="section-title">Industry News</h2>
        <div class="news-grid" id="newsGrid">
            <div class="loading">Loading news...</div>
        </div>
    </section>
</main>

<script>
    class OilTracker {
        constructor() {
            this.apiProxies = [
                'https://cors-anywhere.herokuapp.com/',
                'https://api.allorigins.win/raw?url='
            ];
            this.currentProxy = 0;
            this.retryCount = 0;
            this.maxRetries = 3;
            this.isOnline = navigator.onLine;
            this.priceData = {};
            this.newsData = [];
            
            this.init();
        }

        init() {
            this.setupEventListeners();
            this.loadCachedData();
            this.fetchPrices();
            this.fetchNews();
            this.startAutoRefresh();
            this.checkOnlineStatus();
        }

        setupEventListeners() {
            document.getElementById('refreshButton').addEventListener('click', () => {
                this.refreshAll();
            });

            window.addEventListener('online', () => {
                this.isOnline = true;
                this.updateStatus('Live', 'online');
                document.getElementById('offlineIndicator').style.display = 'none';
                this.refreshAll();
            });

            window.addEventListener('offline', () => {
                this.isOnline = false;
                this.updateStatus('Offline', 'offline');
                document.getElementById('offlineIndicator').style.display = 'block';
            });
        }

        async fetchWithFallback(url, options = {}) {
            for (let i = 0; i < this.apiProxies.length; i++) {
                try {
                    const proxyUrl = this.apiProxies[i] + encodeURIComponent(url);
                    const response = await fetch(proxyUrl, {
                        ...options,
                        timeout: 10000,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            ...options.headers
                        }
                    });
                    
                    if (response.ok) {
                        this.retryCount = 0;
                        return response;
                    }
                } catch (error) {
                    console.warn(`Proxy ${i + 1} failed:`, error.message);
                    continue;
                }
            }
            
            // Last resort: try direct fetch (might fail due to CORS)
            try {
                const response = await fetch(url, options);
                if (response.ok) return response;
            } catch (error) {
                console.warn('Direct fetch failed:', error.message);
            }
            
            throw new Error('All proxies failed');
        }

        async fetchPrices() {
            if (!this.isOnline) {
                return;
            }

            this.updateStatus('Fetching...', 'loading');
            
            try {
                // Fetch WTI
                const wtiResponse = await this.fetchWithFallback(
                    'https://query1.finance.yahoo.com/v8/finance/chart/CL=F'
                );
                const wtiData = await wtiResponse.json();
                
                // Fetch Brent
                const brentResponse = await this.fetchWithFallback(
                    'https://query1.finance.yahoo.com/v8/finance/chart/BZ=F'
                );
                const brentData = await brentResponse.json();
                
                this.processPriceData(wtiData, 'WTI');
                this.processPriceData(brentData, 'BRENT');
                
                this.cachePriceData();
                this.updateStatus('Live', 'online');
                this.retryCount = 0;
                
            } catch (error) {
                console.error('Price fetch failed:', error);
                this.handleFetchError('prices');
            }
        }

        processPriceData(data, type) {
            try {
                const result = data.chart.result[0];
                const meta = result.meta;
                const quote = result.indicators.quote[0];
                
                const currentPrice = meta.regularMarketPrice || quote.close[quote.close.length - 1];
                const previousClose = meta.previousClose;
                const change = currentPrice - previousClose;
                const changePercent = (change / previousClose) * 100;
                
                this.priceData[type] = {
                    price: currentPrice,
                    change: change,
                    changePercent: changePercent,
                    timestamp: Date.now()
                };
                
                this.updatePriceDisplay(type);
                
                if (type === 'WTI') {
                    this.updateChart(quote.close);
                }
                
            } catch (error) {
                console.error(`Error processing ${type} data:`, error);
            }
        }

        updatePriceDisplay(type) {
            const data = this.priceData[type];
            const isPositive = data.change >= 0;
            
            const priceElement = document.getElementById(type === 'WTI' ? 'wtiPrice' : 'brentPrice');
            const changeElement = document.getElementById(type === 'WTI' ? 'wtiChange' : 'brentChange');
            
            priceElement.textContent = `$${data.price.toFixed(2)}`;
            changeElement.textContent = `${isPositive ? 'â†—' : 'â†˜'} $${Math.abs(data.change).toFixed(2)} (${Math.abs(data.changePercent).toFixed(2)}%)`;
            changeElement.className = `price-change ${isPositive ? 'price-up' : 'price-down'}`;
        }

        updateChart(priceHistory) {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            if (!priceHistory || priceHistory.length < 2) return;
            
            const prices = priceHistory.slice(-20).filter(p => p !== null);
            const min = Math.min(...prices);
            const max = Math.max(...prices);
            const range = max - min || 1;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#ff6600';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            prices.forEach((price, index) => {
                const x = (index / (prices.length - 1)) * canvas.width;
                const y = canvas.height - ((price - min) / range) * canvas.height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        async fetchNews() {
            if (!this.isOnline) {
                return;
            }

            try {
                // Mock news data since RSS feeds require server-side processing
                // In a real implementation, you'd use a news API or RSS proxy
                const mockNews = [
                    {
                        title: "WTI Crude Futures Rise on Supply Concerns",
                        source: "Reuters",
                        time: "2 hours ago",
                        url: "#"
                    },
                    {
                        title: "OPEC+ Meeting Results Impact Oil Markets",
                        source: "Oil & Gas Journal",
                        time: "4 hours ago",
                        url: "#"
                    },
                    {
                        title: "Permian Basin Production Reaches New High",
                        source: "Energy Intelligence",
                        time: "6 hours ago",
                        url: "#"
                    },
                    {
                        title: "Refinery Maintenance Season Affects Crude Demand",
                        source: "Bloomberg",
                        time: "8 hours ago",
                        url: "#"
                    }
                ];
                
                this.newsData = mockNews;
                this.displayNews();
                this.cacheNewsData();
                
            } catch (error) {
                console.error('News fetch failed:', error);
                this.handleFetchError('news');
            }
        }

        displayNews() {
            const newsGrid = document.getElementById('newsGrid');
            newsGrid.innerHTML = '';
            
            if (this.newsData.length === 0) {
                newsGrid.innerHTML = '<div class="loading">No news available</div>';
                return;
            }
            
            this.newsData.forEach(article => {
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.innerHTML = `
                    <div class="news-title">${article.title}</div>
                    <div class="news-meta">
                        <span class="news-source">${article.source}</span>
                        <span>${article.time}</span>
                    </div>
                `;
                
                newsCard.addEventListener('click', () => {
                    if (article.url && article.url !== '#') {
                        window.open(article.url, '_blank');
                    }
                });
                
                newsGrid.appendChild(newsCard);
            });
        }

        cachePriceData() {
            try {
                localStorage.setItem('oilTrackerPrices', JSON.stringify({
                    data: this.priceData,
                    timestamp: Date.now()
                }));
            } catch (error) {
                console.warn('Failed to cache price data:', error);
            }
        }

        cacheNewsData() {
            try {
                localStorage.setItem('oilTrackerNews', JSON.stringify({
                    data: this.newsData,
                    timestamp: Date.now()
                }));
            } catch (error) {
                console.warn('Failed to cache news data:', error);
            }
        }

        loadCachedData() {
            try {
                // Load cached prices
                const cachedPrices = localStorage.getItem('oilTrackerPrices');
                if (cachedPrices) {
                    const pricesData = JSON.parse(cachedPrices);
                    const age = Date.now() - pricesData.timestamp;
                    
                    if (age < 30 * 60 * 1000) { // 30 minutes
                        this.priceData = pricesData.data;
                        Object.keys(this.priceData).forEach(type => {
                            this.updatePriceDisplay(type);
                        });
                    }
                }
                
                // Load cached news
                const cachedNews = localStorage.getItem('oilTrackerNews');
                if (cachedNews) {
                    const newsData = JSON.parse(cachedNews);
                    const age = Date.now() - newsData.timestamp;
                    
                    if (age < 60 * 60 * 1000) { // 1 hour
                        this.newsData = newsData.data;
                        this.displayNews();
                    }
                }
                
            } catch (error) {
                console.warn('Failed to load cached data:', error);
            }
        }

        handleFetchError(type) {
            this.retryCount++;
            
            if (this.retryCount < this.maxRetries) {
                setTimeout(() => {
                    if (type === 'prices') {
                        this.fetchPrices();
                    } else if (type === 'news') {
                        this.fetchNews();
                    }
                }, 5000 * this.retryCount);
            } else {
                this.updateStatus('Error', 'error');
                console.error(`Max retries reached for ${type}`);
            }
        }

        updateStatus(text, type) {
            const statusText = document.getElementById('statusText');
            const statusDot = document.getElementById('statusDot');
            
            statusText.textContent = text;
            
            statusDot.style.background = {
                'online': '#28a745',
                'loading': '#ff6600',
                'offline': '#dc3545',
                'error': '#dc3545'
            }[type] || '#7d8590';
            
            // Update last updated time
            document.getElementById('lastUpdated').textContent = 
                `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        refreshAll() {
            this.retryCount = 0;
            this.fetchPrices();
            this.fetchNews();
        }

        startAutoRefresh() {
            // Refresh prices every 60 seconds
            setInterval(() => {
                if (this.isOnline) {
                    this.fetchPrices();
                }
            }, 60000);
            
            // Refresh news every 10 minutes
            setInterval(() => {
                if (this.isOnline) {
                    this.fetchNews();
                }
            }, 600000);
        }

        checkOnlineStatus() {
            this.isOnline = navigator.onLine;
            this.updateStatus(this.isOnline ? 'Live' : 'Offline', this.isOnline ? 'online' : 'offline');
            
            if (!this.isOnline) {
                document.getElementById('offlineIndicator').style.display = 'block';
            }
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        window.oilTracker = new OilTracker();
    });

    // Service Worker registration for offline support
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCJmZXRjaCIsIGZ1bmN0aW9uKGUpIHsKICBlLnJlc3BvbmRXaXRoKGZldGNoKGUucmVxdWVzdCkpOwp9KTs=')
            .then(() => console.log('SW registered'))
            .catch(() => console.log('SW registration failed'));
    }
</script>
```

</body>
</html>